<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#050505">
    <title>Khalifa Commander V14</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root {
            --bg: #050505;
            --card-bg: #141414;
            --text: #fff;
            --muted: #888;
            
            /* EXTREME GRADIENTS */
            --p1-grad: linear-gradient(135deg, #ff2c2c, #ff6b30);
            --p2-grad: linear-gradient(135deg, #ff8800, #ffbb00);
            --p3-grad: linear-gradient(135deg, #007aff, #00d4ff);
            --p46-grad: linear-gradient(135deg, #7b1fa2, #e040fb);
            --p0-grad: linear-gradient(135deg, #444, #666);
            
            --gold: #ffd700;
            --nav-height: 80px;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; user-select: none; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0; padding: 0;
            padding-top: 140px; 
            padding-bottom: 100px;
            overscroll-behavior-y: none;
        }

        /* --- HEADER --- */
        .fixed-header {
            position: fixed; top: 0; left: 0; right: 0;
            background: rgba(5,5,5,0.96); backdrop-filter: blur(10px);
            z-index: 100; border-bottom: 1px solid #222;
        }
        
        .top-deck {
            display: flex; justify-content: space-between; align-items: center;
            padding: 10px 20px; height: 90px;
        }

        .clock-area h1 { margin: 0; font-size: 1.8rem; font-weight: 800; letter-spacing: -1px; }
        .clock-area p { margin: 0; font-size: 0.7rem; color: var(--muted); text-transform: uppercase; font-weight: 700; letter-spacing: 1px; }

        .header-right { display: flex; align-items: center; gap: 15px; }

        /* RINGS */
        .rings-wrapper { display: flex; gap: 10px; }
        .ring-box { position: relative; width: 50px; height: 50px; }
        .ring-svg { transform: rotate(-90deg); width: 50px; height: 50px; }
        .ring-bg { fill: none; stroke: #222; stroke-width: 4; }
        .ring-val { fill: none; stroke-width: 4; stroke-linecap: round; stroke-dasharray: 126; stroke-dashoffset: 126; transition: stroke-dashoffset 1s, stroke 0.5s; }
        .ring-icon { position: absolute; top:50%; left:50%; transform:translate(-50%,-50%); font-size:0.9rem; }

        /* HAMBURGER */
        .menu-btn { background: none; border: none; color: #fff; font-size: 1.5rem; cursor: pointer; padding: 5px; }

        /* FILTER BAR */
        .filter-bar {
            display: flex; gap: 10px; padding: 0 20px 15px 20px;
            overflow-x: auto;
        }
        .filter-pill {
            background: #1a1a1a; border: 1px solid #333; color: #888;
            padding: 6px 14px; border-radius: 20px; font-size: 0.75rem; font-weight: 700;
            white-space: nowrap; transition: all 0.2s;
        }
        .filter-pill.active { background: #fff; color: #000; }

        /* --- DASHBOARD SUMMARY CARD --- */
        .summary-card {
            background: linear-gradient(180deg, #181818, #0a0a0a);
            margin: 20px 20px 20px 20px; padding: 15px; border-radius: 16px; border: 1px solid #2a2a2a;
            display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 5px; text-align: center;
        }
        .sum-val { font-size: 1.2rem; font-weight: 800; display: block; color: #fff; }
        .sum-label { font-size: 0.6rem; color: #666; text-transform: uppercase; font-weight: 700; }
        .sum-sep { width: 1px; background: #222; height: 30px; margin: auto; }

        /* --- BUDGET OVERVIEW (NY I V14) --- */
        .budget-overview { margin: 0 20px 20px 20px; padding: 15px; background: #0a0a0a; border-radius: 12px; border: 1px solid #222; }
        .budget-row { display: flex; align-items: center; gap: 10px; margin-bottom: 8px; }
        .budget-label { width: 100px; font-size: 0.7rem; color: #888; font-weight: 700; text-transform: uppercase; }
        .budget-bar-bg { flex-grow: 1; height: 8px; background: #222; border-radius: 4px; overflow: hidden; }
        .budget-bar-fill { height: 100%; transition: width 0.5s; }
        .budget-text { font-family: monospace; font-size: 0.7rem; color: #aaa; width: 55px; text-align: right; }

        /* --- TASK CARDS --- */
        .zone-header {
            margin: 30px 20px 10px 20px; 
            display: flex; justify-content: space-between; align-items: flex-end;
            padding-bottom: 5px; border-bottom: 1px solid #222;
        }
        .zone-title { font-size: 0.8rem; font-weight: 900; color: #fff; text-transform: uppercase; letter-spacing: 0.5px; }
        .zone-stats { font-size: 0.75rem; font-family: monospace; color: #666; }

        .task-card {
            background: var(--card-bg); margin: 0 20px 15px 20px; padding: 18px;
            border-radius: 16px; border: 1px solid #222;
            position: relative; overflow: hidden; transition: transform 0.1s;
        }
        .task-card:active { transform: scale(0.98); }
        .task-card.disabled { opacity: 0.3; pointer-events: none; }

        /* THE CHARGING ANIMATION */
        .task-card.pressing { transform: scale(0.95); transition: transform 1.2s cubic-bezier(0.2, 0.8, 0.2, 1); }

        /* GRADIENT BORDERS */
        .prio-0 { border-left: 4px solid #aaa; }
        .prio-1 { border-left: 4px solid #ff2c2c; }
        .prio-2 { border-left: 4px solid #ff8800; }
        .prio-3 { border-left: 4px solid #007aff; }
        .prio-low { border-left: 4px solid #7b1fa2; opacity: 0.9; }

        /* STATES */
        .recording { background: #1a0a0a; border-color: #ff3b30; box-shadow: 0 0 20px rgba(255,59,48,0.1); }
        .paused { background: #1a1505; border-color: #ffb74d; animation: pulseYellow 3s infinite; }
        .done .task-title { color: var(--gold); }
        
        @keyframes pulseYellow { 0% { border-color: #ffb74d; } 50% { border-color: #554010; } 100% { border-color: #ffb74d; } }

        /* CARD CONTENT */
        .card-top { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
        .task-title { font-size: 1rem; font-weight: 700; display: block; margin-bottom: 3px; }
        .task-meta { font-size: 0.75rem; color: #666; display: flex; flex-direction: column; gap: 2px; }
        .task-meta-row { display:flex; gap: 10px; align-items: center; }
        
        /* CONTROLS */
        .control-group { display: flex; align-items: center; gap: 8px; }
        
        .badge-container { display: flex; flex-direction: column; align-items: flex-end; }
        .timer-badge { 
            font-family: monospace; font-size: 0.85rem; color: #555; background: #000; 
            padding: 6px 10px; border-radius: 6px; min-width: 65px; text-align: center; 
        }
        .pending-text { font-size: 0.65rem; color: #ffb74d; margin-top: 2px; font-weight: bold; }

        .recording .timer-badge { color: #fff; background: #d32f2f; }
        .paused .timer-badge { color: #000; background: #ffb74d; }

        .btn-main {
            width: 50px; height: 50px; border-radius: 50%; border: none;
            background: #252525; color: #fff; font-size: 1.2rem;
            display: flex; align-items: center; justify-content: center;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3); transition: all 0.2s;
        }
        .btn-stop {
            width: 35px; height: 35px; border-radius: 50%; border: none;
            background: #222; color: #ff2c2c; font-size: 0.9rem;
            display: none; align-items: center; justify-content: center;
        }
        
        .btn-add {
            width: 32px; height: 32px; border-radius: 50%;
            background: #333; color: #aaa; border: none;
            font-size: 0.85rem;
            display: flex; align-items: center; justify-content: center;
            transition: all 0.2s; margin-right: 5px;
        }
        .btn-add:active { transform: scale(0.9); background: #444; }

        .btn-fullday { 
            width: 100%; padding: 8px; margin-top: 12px; background: #222; 
            border: 1px solid #444; color: #888; border-radius: 8px; font-size: 0.75rem; 
        }

        /* DYNAMIC COLORS */
        .prio-0 .recording .btn-main { background: var(--p0-grad); }
        .prio-1 .recording .btn-main { background: var(--p1-grad); }
        .prio-2 .recording .btn-main { background: var(--p2-grad); }
        .prio-3 .recording .btn-main { background: var(--p3-grad); }
        .prio-low .recording .btn-main { background: var(--p46-grad); }
        
        .paused .btn-main { background: #ffb74d !important; color: #000; }

        .recording .btn-stop, .paused .btn-stop { display: flex; }

        /* Progress Bar */
        .card-progress-bg { height: 4px; background: #222; border-radius: 2px; overflow: hidden; margin-top: 10px; }
        .card-progress-fill { height: 100%; background: #444; width: 0%; transition: width 0.5s; max-width: 200%; }
        
        .prio-0 .card-progress-fill { background: var(--p0-grad); }
        .prio-1 .card-progress-fill { background: var(--p1-grad); }
        .prio-2 .card-progress-fill { background: var(--p2-grad); }
        .prio-3 .card-progress-fill { background: var(--p3-grad); }
        .prio-low .card-progress-fill { background: var(--p46-grad); }
        
        /* Over 100% */
        .over-target .card-progress-fill { background: var(--gold) !important; }

        /* --- STATS VIEW --- */
        .view-section { display: none; padding: 0 20px 20px 20px; }
        .view-section.active { display: block; animation: fadeIn 0.3s; }
        
        .chart-container { display: flex; justify-content: space-between; align-items: flex-end; height: 150px; margin: 20px 0; border-bottom: 1px solid #333; padding-bottom: 5px; }
        .chart-col { display: flex; flex-direction: column; align-items: center; width: 12%; }
        .chart-bar { width: 100%; background: #333; border-radius: 4px 4px 0 0; transition: height 0.5s; min-height: 2px; }
        .chart-day { font-size: 0.6rem; color: #666; margin-top: 5px; }

        .dist-bar { display: flex; align-items: center; margin-bottom: 15px; }
        .dist-label { width: 80px; font-size: 0.75rem; color: #aaa; font-weight: bold; }
        .dist-track { flex-grow: 1; height: 24px; background: #222; border-radius: 4px; margin: 0 10px; position: relative; overflow: hidden; }
        .dist-fill { height: 100%; border-radius: 4px; display: flex; align-items: center; padding-left: 8px; font-size: 0.7rem; color: #fff; text-shadow: 0 0 2px rgba(0,0,0,0.5); font-weight: bold; width: 0%; transition: width 0.5s;}
        
        /* --- BOTTOM NAV --- */
        .nav-bar {
            position: fixed; bottom: 0; left: 0; right: 0; height: 80px;
            background: #000; border-top: 1px solid #1a1a1a;
            display: grid; grid-template-columns: 1fr 1fr;
            z-index: 150;
        }
        .nav-btn {
            background: none; border: none; color: #555;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            font-size: 0.75rem; gap: 6px; font-weight: 700;
        }
        .nav-btn.active { color: #fff; }
        .nav-btn i { font-size: 1.4rem; }

        /* --- OVERLAYS --- */
        .toast {
            position: fixed; bottom: 90px; left: 20px; right: 20px;
            background: #222; border: 1px solid #333; color: #fff;
            padding: 15px; border-radius: 10px;
            display: flex; justify-content: space-between; align-items: center;
            transform: translateY(150%); transition: transform 0.3s; z-index: 200;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        .toast.show { transform: translateY(0); }
        .btn-undo { background: none; border: 1px solid #555; color: #fff; padding: 5px 12px; border-radius: 20px; font-size: 0.8rem; }
        .toast-msg { display: flex; align-items: center; gap: 10px; font-size: 0.9rem; }

        /* MODALS */
        .modal { display: none; position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.95); z-index:300; align-items:center; justify-content:center; }
        .modal-content { background:#222; padding:25px; border-radius:15px; width:85%; text-align:center; border: 1px solid #444; }
        .modal-btn { width:100%; padding:15px; background:#333; border:none; color:#fff; border-radius:8px; margin-bottom:10px; font-weight:bold; font-size: 1rem; }
        .slider-container { margin: 20px 0; text-align: left; }
        input[type=range] { width: 100%; margin-top: 10px; }
        
        #confetti { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 9999; }

        @keyframes pulseYellow { 0% { border-color: #ffb74d; } 50% { border-color: #554010; } 100% { border-color: #ffb74d; } }
        @keyframes fadeIn { from { opacity:0; } to { opacity:1; } }

    </style>
</head>
<body>

    <canvas id="confetti"></canvas>

    <!-- HEADER -->
    <div class="fixed-header">
        <div class="top-deck">
            <div class="clock-area">
                <h1 id="clock">07:00</h1>
                <p>COMMANDER V14</p>
            </div>
            
            <div class="header-right">
                <div class="rings-wrapper">
                    <!-- Ring 1: Tid (17h) -->
                    <div class="ring-box">
                        <svg class="ring-svg" viewBox="0 0 50 50">
                            <circle class="ring-bg" cx="25" cy="25" r="20"></circle>
                            <circle id="ring-day" class="ring-val" cx="25" cy="25" r="20" stroke="#666"></circle>
                        </svg>
                        <div class="ring-icon">üïí</div>
                    </div>
                    <!-- Ring 2: Budget -->
                    <div class="ring-box">
                        <svg class="ring-svg" viewBox="0 0 50 50">
                            <circle class="ring-bg" cx="25" cy="25" r="20"></circle>
                            <circle id="ring-budget" class="ring-val" cx="25" cy="25" r="20" stroke="#ff8800"></circle>
                        </svg>
                        <div class="ring-icon">üî•</div>
                    </div>
                </div>
                <button class="menu-btn" onclick="openSettings()"><i class="fas fa-bars"></i></button>
            </div>
        </div>

        <div class="filter-bar">
            <div class="filter-pill active" onclick="setFilter('today', this)">IDAG</div>
            <div class="filter-pill" onclick="setFilter('all', this)">ALLA</div>
            <div class="filter-pill" onclick="setFilter('todo', this)">G√ñRA</div>
        </div>
    </div>

    <!-- MAIN DASHBOARD -->
    <div id="view-today" class="view-section active">
        <!-- FIXED SUMMARY CARD -->
        <div class="summary-card">
            <div>
                <span class="sum-val" id="sum-time">0h 0m</span>
                <span class="sum-label">Totalt Idag</span>
            </div>
            <div class="sum-sep"></div>
            <div>
                <span class="sum-val" id="sum-tasks">0/0</span>
                <span class="sum-label">Klara M√•l</span>
            </div>
            <div class="sum-sep"></div>
            <div>
                <span class="sum-val" id="sum-eff">0%</span>
                <span class="sum-label">Av Dagens M√•l</span>
            </div>
        </div>

        <!-- BUDGET OVERVIEW (NY I V14) -->
        <div class="budget-overview">
            <div class="budget-row">
                <span class="budget-label">PRIO 1 (TUNG)</span>
                <div class="budget-bar-bg">
                    <div class="budget-bar-fill" id="budget-p1" style="background:var(--p1-grad)"></div>
                </div>
                <span class="budget-text" id="budget-p1-text">0h/6h</span>
            </div>
            <div class="budget-row">
                <span class="budget-label">PRIO 2 (BALANS)</span>
                <div class="budget-bar-bg">
                    <div class="budget-bar-fill" id="budget-p2" style="background:var(--p2-grad)"></div>
                </div>
                <span class="budget-text" id="budget-p2-text">0h/4h</span>
            </div>
            <div class="budget-row">
                <span class="budget-label">PRIO 3 (GRUND)</span>
                <div class="budget-bar-bg">
                    <div class="budget-bar-fill" id="budget-p3" style="background:var(--p3-grad)"></div>
                </div>
                <span class="budget-text" id="budget-p3-text">0h/4h</span>
            </div>
            <div style="height:10px;"></div>
            <div class="budget-row">
                <span class="budget-label">PRIO 0 (VECKA)</span>
                <div class="budget-bar-bg">
                    <div class="budget-bar-fill" id="budget-p0" style="background:#666"></div>
                </div>
                <span class="budget-text" id="budget-p0-text">0h/14h</span>
            </div>
        </div>

        <div id="task-list"></div>
    </div>

    <!-- STATS VIEW -->
    <div id="view-stats" class="view-section">
        <h2>Veckans √ñversikt</h2>
        <div id="week-chart" class="chart-container"></div>
        
        <h2>Prio F√∂rdelning</h2>
        <div id="prio-breakdown"></div>
    </div>

    <!-- SETTINGS MODAL -->
    <div id="modal-settings" class="modal" onclick="if(event.target===this) this.style.display='none'">
        <div class="modal-content">
            <h3>Inst√§llningar</h3>
            
            <div class="slider-container">
                <label style="color:#aaa; font-size:0.9rem;">Dagens M√•l: <span id="goal-display" style="color:#fff; font-weight:bold;">14h</span></label>
                <input type="range" id="goal-slider" min="60" max="1020" step="30" oninput="updateGoal(this.value)">
            </div>

            <button class="modal-btn" onclick="exportData()"><i class="fas fa-download"></i> Exportera Data</button>
            <button class="modal-btn" onclick="document.getElementById('file-input').click()"><i class="fas fa-upload"></i> Importera Data</button>
            <input type="file" id="file-input" style="display:none" onchange="importData(this)">
            
            <button class="modal-btn" style="background:#8b0000; margin-top:20px;" onclick="confirmReset()">
                <i class="fas fa-exclamation-triangle"></i> Nollst√§ll Dagens Data
            </button>

            <button class="modal-btn" style="background:#444; margin-top:10px;" onclick="document.getElementById('modal-settings').style.display='none'">St√§ng</button>
        </div>
    </div>

    <!-- ADD TIME MODAL -->
    <div id="modal-addtime" class="modal" onclick="if(event.target===this) closeAddTime()">
        <div class="modal-content">
            <h3>‚è±Ô∏è L√§gg till tid</h3>
            <p id="add-project-title" style="color:#aaa; font-size:0.9rem; margin-bottom:20px;">Projekt</p>
            
            <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-bottom:20px;">
                <button class="modal-btn" style="padding:12px;" onclick="quickAddTime(15)">+15 min</button>
                <button class="modal-btn" style="padding:12px;" onclick="quickAddTime(30)">+30 min</button>
                <button class="modal-btn" style="padding:12px;" onclick="quickAddTime(60)">+1h</button>
                <button class="modal-btn" style="padding:12px;" onclick="quickAddTime(120)">+2h</button>
            </div>
            
            <div style="margin:20px 0; text-align:left;">
                <label style="color:#aaa; font-size:0.9rem;">
                    Custom: <span id="custom-time-display" style="color:#fff; font-weight:bold;">45 min</span>
                </label>
                <input type="range" id="custom-time-slider" min="5" max="300" step="5" value="45" 
                       oninput="document.getElementById('custom-time-display').innerText = this.value + ' min'">
            </div>
            
            <button class="modal-btn" style="background:var(--p2-grad);" onclick="quickAddTime(parseInt(document.getElementById('custom-time-slider').value))">
                <i class="fas fa-check"></i> L√§gg till Custom
            </button>
            
            <button class="modal-btn" style="background:#444; margin-top:10px;" onclick="closeAddTime()">
                Avbryt
            </button>
        </div>
    </div>

    <!-- TOAST -->
    <div id="toast" class="toast">
        <span class="toast-msg"><i class="fas fa-info-circle"></i> Meddelande</span>
        <button id="toast-undo-btn" class="btn-undo" onclick="undoLast()">√ÖNGRA</button>
    </div>

    <!-- BOTTOM NAV -->
    <div class="nav-bar">
        <button class="nav-btn active" onclick="switchView('today', this)"><i class="fas fa-bolt"></i>FOKUS</button>
        <button class="nav-btn" onclick="switchView('stats', this)"><i class="fas fa-chart-bar"></i>STATISTIK</button>
    </div>

<script>
    // --- KONFIGURATION (27 PROJEKT) ---
    const projects = [
        // PRIO 0 (Vecka)
        { id: 'video_edit', title: 'Videoredigering', icon: 'üé¨', prio: 0, target: 840, period: 'week' },
        
        // PRIO 1 (Dag)
        { id: 'yt_long', title: 'YouTube L√•ng', icon: 'üìπ', prio: 1, target: 120, period: 'day' },
        { id: 'yt_short', title: 'YouTube Kort', icon: 'üì±', prio: 1, target: 60, period: 'day' },
        
        // PRIO 2 (Dag)
        { id: 'social', title: 'Social Media', icon: 'üí¨', prio: 2, target: 45, period: 'day' },
        { id: 'fam_act', title: 'Familj & Lek', icon: 'üé≤', prio: 2, target: 60, period: 'day' },
        { id: 'azzah', title: 'Azzah Tid', icon: '‚ù§Ô∏è', prio: 2, target: 60, period: 'day' },
        { id: 'kids', title: 'Barn 1-mot-1', icon: 'üë∂', prio: 2, target: 30, period: 'day' },
        { id: 'health', title: 'H√§lsa', icon: 'üåø', prio: 2, target: 45, period: 'day' },
        
        // PRIO 3 (Dag)
        { id: 'prayer', title: 'B√∂n & Adhkar', icon: 'üìø', prio: 3, target: 30, period: 'day' },
        { id: 'meals', title: 'Mat & Hus', icon: 'üè†', prio: 3, target: 45, period: 'day' },
        { id: 'autobio', title: 'Sj√§lvbiografi', icon: 'üìö', prio: 3, target: 15, period: 'day' },
        { id: 'learning', title: 'L√§rande', icon: 'üß†', prio: 3, target: 30, period: 'day' },
        
        // PRIO 4 (Vecka)
        { id: 'thriller', title: 'Bok: Deckare', icon: 'üïµÔ∏è‚Äç‚ôÇÔ∏è', prio: 4, target: 30, period: 'week' },
        { id: 'biz', title: 'Business/Merch', icon: 'üíº', prio: 4, target: 30, period: 'week' },
        { id: 'prep', title: 'Meal Prep', icon: 'ü•¶', prio: 4, target: 60, period: 'week' },
        { id: 'podcast', title: 'Podcast', icon: 'üéôÔ∏è', prio: 4, target: 30, period: 'week' },
        { id: 'groups', title: 'Online Grupper', icon: 'üë•', prio: 4, target: 30, period: 'week' },
        
        // PRIO 5 (Biweek)
        { id: 'coach_setup', title: 'Coaching Setup', icon: 'üéì', prio: 5, target: 30, period: 'biweek' },
        { id: 'fam_coach', title: 'Familj & Faderscoach', icon: 'üë®‚Äçüë©‚Äçüëß', prio: 5, target: 30, period: 'biweek' },
        
        // PRIO 6 (Month)
        { id: 'adhd_book', title: 'ADHD Bok', icon: 'üìñ', prio: 6, target: 30, period: 'month' },
        { id: 'blog', title: 'Blogg/Artiklar', icon: 'üìù', prio: 6, target: 30, period: 'month' },
        { id: 'basketball', title: 'Basketball', icon: 'üèÄ', prio: 6, target: 30, period: 'month' },
        { id: 'workshop', title: 'Workshopdesign', icon: 'üé®', prio: 6, target: 30, period: 'month' },
        { id: 'ai_tech', title: 'AI & Tech', icon: 'ü§ñ', prio: 6, target: 30, period: 'month' },
        { id: 'strategy', title: 'Strategi', icon: '‚ôüÔ∏è', prio: 6, target: 30, period: 'month' },
        { id: 'networking', title: 'Socialt/N√§tverkande', icon: 'üåê', prio: 6, target: 30, period: 'month' }
    ];

    const WAKE_TIME = 7; 
    const SLEEP_TIME = 24;

    // --- STATE MANAGER ---
    let history = JSON.parse(localStorage.getItem('khalifa_v14_hist')) || {};
    let sessions = JSON.parse(localStorage.getItem('khalifa_v14_sessions')) || {};
    let workGoal = parseInt(localStorage.getItem('khalifa_v14_goal')) || 840; 
    let undoStack = JSON.parse(localStorage.getItem('khalifa_v14_undo')) || [];
    let lastDone = JSON.parse(localStorage.getItem('khalifa_v14_lastDone')) || {};
    let periodProgress = JSON.parse(localStorage.getItem('khalifa_v14_periodProgress')) || {};
    
    const MAX_UNDO = 10;
    let filterMode = 'today';
    let cachedStreaks = {}; 
    let isFullDayMode = false;
    let fullDayProjectId = null;

    // --- HELPER FUNCTIONS ---
    function getTodayStr() { return new Date().toISOString().split('T')[0]; }
    function getTodayData() { 
        const d = getTodayStr();
        if(!history[d]) history[d] = {};
        return history[d];
    }
    function saveState() {
        localStorage.setItem('khalifa_v14_hist', JSON.stringify(history));
        localStorage.setItem('khalifa_v14_sessions', JSON.stringify(sessions));
        localStorage.setItem('khalifa_v14_goal', workGoal);
        localStorage.setItem('khalifa_v14_undo', JSON.stringify(undoStack));
        localStorage.setItem('khalifa_v14_lastDone', JSON.stringify(lastDone));
        localStorage.setItem('khalifa_v14_periodProgress', JSON.stringify(periodProgress));
    }
    function vibrate(ms) { if(navigator.vibrate) navigator.vibrate(ms); }

    function getWeekNumber(d) {
        d = new Date(Date.UTC(d.getFullYear(), d.getMonth(), d.getDate()));
        d.setUTCDate(d.getUTCDate() + 4 - (d.getUTCDay()||7));
        const yearStart = new Date(Date.UTC(d.getUTCFullYear(),0,1));
        return Math.ceil((((d - yearStart) / 86400000) + 1)/7);
    }

    // --- RESET LOGIC ---
    function checkPeriodResets() {
        const today = new Date();
        const dateStr = today.toDateString();
        const lastCheck = localStorage.getItem('khalifa_v14_resetCheck');
        
        if (lastCheck === dateStr) return; // Redan kollat idag

        const dayOfWeek = today.getDay(); // 1 = Monday
        const dayOfMonth = today.getDate(); // 1 = 1st
        const weekNum = getWeekNumber(today);

        let didReset = false;

        // Reset Weekly (Monday)
        if (dayOfWeek === 1) {
            projects.filter(p => p.period === 'week').forEach(p => periodProgress[p.id] = 0);
            // Prio 0 (Video) √§r ocks√• week
            projects.filter(p => p.prio === 0).forEach(p => periodProgress[p.id] = 0);
            didReset = true;
        }

        // Reset Biweekly (Monday even weeks)
        if (dayOfWeek === 1 && weekNum % 2 === 0) {
            projects.filter(p => p.period === 'biweek').forEach(p => periodProgress[p.id] = 0);
            didReset = true;
        }

        // Reset Monthly (1st)
        if (dayOfMonth === 1) {
            projects.filter(p => p.period === 'month').forEach(p => periodProgress[p.id] = 0);
            didReset = true;
        }

        if (didReset) {
            saveState();
            showToast("üîÑ Periodiska m√•l nollst√§llda", false);
        }
        
        localStorage.setItem('khalifa_v14_resetCheck', dateStr);
    }

    // --- STREAK OPTIMIZATION ---
    function updateStreaks() {
        cachedStreaks = {};
        projects.forEach(p => {
            let s = 0;
            for(let i=1; i<30; i++) {
                const d = new Date(); d.setDate(d.getDate() - i);
                const ds = d.toISOString().split('T')[0];
                if(history[ds] && history[ds][p.id] > 10) s++;
                else break;
            }
            cachedStreaks[p.id] = s;
        });
    }

    // --- RENDER ENGINE ---
    function render() {
        if(Object.keys(cachedStreaks).length === 0) updateStreaks();
        renderList();
        renderBudgets();
        renderSummary();
        updateRings();
    }

    function shouldShowInTodayFilter(p) {
        if (p.prio <= 3) return true;
        const last = lastDone[p.id];
        const daysSince = last ? Math.floor((Date.now() - new Date(last)) / (86400000)) : 999;
        const curr = periodProgress[p.id] || 0;
        const notDone = curr < p.target;
        
        if (p.prio === 4) return daysSince > 7 || notDone;
        if (p.prio === 5) return daysSince > 14 || notDone;
        if (p.prio === 6) return daysSince > 30 || notDone;
        return false;
    }

    function getLastDoneText(id, prio) {
        const last = lastDone[id];
        if (!last) return "‚ùì Aldrig";
        const days = Math.floor((Date.now() - new Date(last)) / (86400000));
        if (days === 0) return "‚úÖ Idag";
        if (days === 1) return "üìÖ Ig√•r";
        return `üìÖ ${days}d sedan`;
    }

    function renderList() {
        const list = document.getElementById('task-list');
        list.innerHTML = '';
        const todayData = getTodayData();

        // Group headers
        let zoneStats = { 0:{d:0,t:0}, 1:{d:0,t:0}, 2:{d:0,t:0}, 3:{d:0,t:0}, 4:{d:0,t:0} };
        projects.forEach(p => {
            const z = p.prio > 3 ? 4 : p.prio;
            zoneStats[z].t += p.target;
            zoneStats[z].d += (p.period === 'day' ? (todayData[p.id] || 0) : (periodProgress[p.id] || 0));
        });

        const sorted = [...projects].sort((a,b) => a.prio - b.prio);
        let lastPrio = -1;

        sorted.forEach(p => {
            if (filterMode === 'today' && !shouldShowInTodayFilter(p)) return;
            
            // Progress Calculation
            let currentProgress, targetProgress;
            if (p.period === 'day') {
                currentProgress = todayData[p.id] || 0;
            } else {
                currentProgress = periodProgress[p.id] || 0;
            }
            targetProgress = p.target;
            
            if (filterMode === 'todo' && currentProgress >= targetProgress) return;

            // Headers
            if(p.prio !== lastPrio) {
                let z = p.prio > 3 ? 4 : p.prio;
                let label = "FRAMTID";
                let icon = "üöÄ";
                if(z===0) { label="HELDAG / VECKA"; icon="üî•"; }
                if(z===1) { label="TUNG ZON"; icon="üî¥"; }
                if(z===2) { label="BALANS"; icon="üü†"; }
                if(z===3) { label="GRUND"; icon="üîµ"; }

                const doneH = formatTimeShort(zoneStats[z].d);
                const targH = formatTimeShort(zoneStats[z].t);

                list.innerHTML += `
                    <div class="zone-header">
                        <span class="zone-title">${icon} ${label}</span>
                        <span class="zone-stats">${doneH} / ${targH}</span>
                    </div>`;
                lastPrio = p.prio;
            }

            // Session data
            const session = sessions[p.id];
            const isRunning = session && session.state === 'running';
            const isPaused = session && session.state === 'paused';
            
            let pendingMins = 0;
            if (session) {
                const elapsed = isRunning ? (Date.now() - session.startTime) : 0;
                pendingMins = Math.floor((session.accumulated + elapsed) / 60000);
            }

            const totalDisplayMins = currentProgress + pendingMins;
            const progressPct = (totalDisplayMins / targetProgress) * 100;
            const isOverTarget = progressPct > 100;
            const streak = cachedStreaks[p.id] || 0;

            // Classes
            let classes = 'task-card';
            if(p.prio === 0) classes += ' prio-0';
            else if(p.prio === 1) classes += ' prio-1';
            else if(p.prio === 2) classes += ' prio-2';
            else if(p.prio === 3) classes += ' prio-3';
            else classes += ' prio-low';

            if(isRunning) classes += ' recording';
            if(isPaused) classes += ' paused';
            if(currentProgress >= targetProgress && !isRunning) classes += ' done';
            if(isOverTarget) classes += ' over-target';
            if(isFullDayMode && p.id !== fullDayProjectId) classes += ' disabled';

            // Text logic
            let timeTxt = formatTime(currentProgress);
            if (p.period !== 'day') {
                let suffix = p.period === 'week' ? 'v' : (p.period === 'biweek' ? '2v' : 'm√•n');
                timeTxt = `${formatTime(currentProgress)}/${formatTime(targetProgress)} ${suffix}`;
            }
            
            if (isRunning) timeTxt = "REC...";
            
            let pendingTxt = "";
            if (isPaused && pendingMins > 0) pendingTxt = `+${pendingMins}m P√ÖG√ÖR`;

            const streakHtml = streak > 0 ? `<span style="color:#ff9800; font-size:0.7rem;">üî• ${streak}</span>` : '';
            const lastDoneTxt = getLastDoneText(p.id, p.prio);

            // Fullday Button for Prio 0
            let extraBtn = '';
            if (p.prio === 0) {
                extraBtn = `<button class="btn-fullday" onclick="toggleFullDayMode('${p.id}', event)">
                    ${isFullDayMode ? 'üîì Avsluta Heldag' : 'üîí Heldag-l√§ge'}
                </button>`;
            }

            let btnIcon = isRunning ? '<i class="fas fa-pause"></i>' : '<i class="fas fa-play"></i>';

            const html = `
                <div class="${classes}" id="card-${p.id}" 
                     oncontextmenu="return false;" 
                     ontouchstart="startLongPress('${p.id}', event)" 
                     ontouchend="cancelLongPress()"
                     onmousedown="startLongPress('${p.id}', event)" 
                     onmouseup="cancelLongPress()">
                     
                    <div class="card-top">
                        <div style="flex-grow:1">
                            <span class="task-title">${p.icon} ${p.title}</span>
                            <div class="task-meta">
                                <div class="task-meta-row">
                                    <span>M√•l: ${p.target}m</span>
                                    ${streakHtml}
                                </div>
                                <div class="task-meta-row" style="color:#666; font-size:0.7rem;">
                                    ${lastDoneTxt}
                                </div>
                            </div>
                        </div>
                        <div class="control-group">
                            <div class="badge-container">
                                <div class="timer-badge" id="badge-${p.id}">${timeTxt}</div>
                                <div class="pending-text" id="pending-${p.id}">${pendingTxt}</div>
                            </div>
                            <button class="btn-add" onclick="openAddTime('${p.id}', event)"><i class="fas fa-plus"></i></button>
                            <button class="btn-stop" onclick="stopTask('${p.id}', event)"><i class="fas fa-stop"></i></button>
                            <button class="btn-main" onclick="toggleTask('${p.id}', event)">${btnIcon}</button>
                        </div>
                    </div>
                    <div class="card-progress-bg">
                        <div class="card-progress-fill" style="width:${Math.min(progressPct, 200)}%"></div>
                    </div>
                    ${extraBtn}
                </div>
            `;
            list.innerHTML += html;
        });
    }

    function renderBudgets() {
        const d = getTodayData();
        let budgets = { 1: 0, 2: 0, 3: 0 };
        
        // Prio 1-3
        projects.forEach(p => {
            if (p.prio >= 1 && p.prio <= 3) {
                let m = d[p.id] || 0;
                if (sessions[p.id]) {
                    const elapsed = sessions[p.id].state === 'running' ? (Date.now() - sessions[p.id].startTime) : 0;
                    m += Math.floor((sessions[p.id].accumulated + elapsed) / 60000);
                }
                budgets[p.prio] += m;
            }
        });

        const updateBar = (id, val, max) => {
            const pct = Math.min(100, (val/max)*100);
            document.getElementById(id).style.width = pct + '%';
            document.getElementById(id+'-text').innerText = formatTime(val) + '/' + formatTime(max);
        };

        updateBar('budget-p1', budgets[1], 360); // 6h
        updateBar('budget-p2', budgets[2], 240); // 4h
        updateBar('budget-p3', budgets[3], 240); // 4h

        // Prio 0 (Video) - Weekly
        const p0Mins = periodProgress['video_edit'] || 0;
        let p0Pending = 0;
        if (sessions['video_edit']) {
             const elapsed = sessions['video_edit'].state === 'running' ? (Date.now() - sessions['video_edit'].startTime) : 0;
             p0Pending = Math.floor((sessions['video_edit'].accumulated + elapsed) / 60000);
        }
        updateBar('budget-p0', p0Mins + p0Pending, 840); // 14h
    }

    // --- TIMER ENGINE ---
    function toggleTask(id, e) {
        if(e) e.stopPropagation();
        vibrate(20);
        const now = Date.now();
        
        if (sessions[id]) {
            if (sessions[id].state === 'running') {
                sessions[id].accumulated += (now - sessions[id].startTime);
                sessions[id].state = 'paused';
                sessions[id].startTime = null;
            } else if (sessions[id].state === 'paused') {
                sessions[id].state = 'running';
                sessions[id].startTime = now;
            }
        } else {
            sessions[id] = { accumulated: 0, state: 'running', startTime: now };
        }
        saveState(); render();
    }

    function stopTask(id, e) {
        if(e) e.stopPropagation();
        vibrate(40);
        if(!sessions[id]) return;
        
        let final = 0;
        if(sessions[id].state === 'running') final = Date.now() - sessions[id].startTime;
        const total = sessions[id].accumulated + final;
        const mins = Math.floor(total / 60000);
        
        if(mins > 0) commitTime(id, mins);
        delete sessions[id];
        saveState(); render();
    }

    function commitTime(id, mins) {
        const d = getTodayStr();
        if(!history[d]) history[d] = {};
        if(!history[d][id]) history[d][id] = 0;
        history[d][id] += mins;

        // V14 Updates
        const p = projects.find(x => x.id === id);
        
        // 1. Last Done
        lastDone[id] = d;
        
        // 2. Period Progress
        if (p.period !== 'day') {
            if(!periodProgress[id]) periodProgress[id] = 0;
            periodProgress[id] += mins;
        }

        // Confetti logic (check period target or daily target)
        let currentTotal = p.period === 'day' ? history[d][id] : periodProgress[id];
        if ((currentTotal - mins) < p.target && currentTotal >= p.target) {
            setTimeout(triggerConfetti, 500);
            vibrate([100, 50, 100]);
        }

        // Undo
        undoStack.push({ date: d, id: id, mins: mins, timestamp: Date.now() });
        if(undoStack.length > MAX_UNDO) undoStack.shift();

        showToast(`üíæ ${mins}m sparad.`, true);
        saveState();
    }

    function undoLast() {
        if(undoStack.length === 0) return;
        const act = undoStack.pop();
        const p = projects.find(x => x.id === act.id);

        // Reverse history
        history[act.date][act.id] -= act.mins;
        if(history[act.date][act.id] < 0) history[act.date][act.id] = 0;

        // Reverse Period Progress
        if(p.period !== 'day' && periodProgress[act.id]) {
            periodProgress[act.id] -= act.mins;
            if(periodProgress[act.id] < 0) periodProgress[act.id] = 0;
        }

        saveState();
        document.getElementById('toast').classList.remove('show');
        render();
    }

    // --- FULL DAY MODE ---
    function toggleFullDayMode(id, e) {
        if(e) e.stopPropagation();
        isFullDayMode = !isFullDayMode;
        fullDayProjectId = isFullDayMode ? id : null;
        render();
        if(isFullDayMode) showToast("üî• HELDAG-L√ÑGE AKTIVERAT", false);
    }

    // --- MANUAL TIME ---
    let addTimeProjectId = null;
    function openAddTime(id, e) {
        if(e) e.stopPropagation();
        addTimeProjectId = id;
        const p = projects.find(x => x.id === id);
        document.getElementById('add-project-title').innerText = `${p.icon} ${p.title}`;
        document.getElementById('custom-time-slider').value = 45;
        document.getElementById('custom-time-display').innerText = '45 min';
        document.getElementById('modal-addtime').style.display = 'flex';
    }
    function closeAddTime() { document.getElementById('modal-addtime').style.display = 'none'; addTimeProjectId = null; }
    function quickAddTime(mins) {
        if(!addTimeProjectId) return;
        vibrate(30);
        commitTime(addTimeProjectId, parseInt(mins));
        closeAddTime();
        render();
        showToast(`‚è±Ô∏è +${mins}m tillagd manuellt`, true);
    }

    // --- LONG PRESS ---
    let pressTimer, startX, startY, moved;
    function startLongPress(id, e) {
        if(e.touches) { startX = e.touches[0].clientX; startY = e.touches[0].clientY; } 
        else { startX = e.clientX; startY = e.clientY; }
        moved = false;
        const card = document.getElementById(`card-${id}`);
        card.classList.add('pressing');
        pressTimer = setTimeout(() => {
            if(!moved) {
                vibrate(100);
                commitTime(id, 5);
                card.classList.remove('pressing');
                showToast("‚ö° +5 minuter tillagt!", true);
                render();
            }
        }, 1200);
    }
    function cancelLongPress() { 
        clearTimeout(pressTimer);
        document.querySelectorAll('.task-card').forEach(c => c.classList.remove('pressing'));
    }

    // --- LIVE LOOP ---
    setInterval(() => {
        document.getElementById('clock').innerText = new Date().toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'});
        Object.keys(sessions).forEach(id => {
            if(sessions[id].state === 'running') {
                const ms = sessions[id].accumulated + (Date.now() - sessions[id].startTime);
                const totalSec = Math.floor(ms/1000);
                const txt = `${Math.floor(totalSec/60)}:${String(totalSec%60).padStart(2,'0')}`;
                const el = document.getElementById(`badge-${id}`);
                if(el) el.innerText = txt;
            }
        });
        renderBudgets(); // Update bars live
    }, 1000);

    // --- STANDARD UTILS ---
    function renderSummary() {
        const d = getTodayData();
        let total = 0, doneCount = 0;
        projects.forEach(p => {
            let m = d[p.id] || 0;
            if(sessions[p.id]) {
                const el = sessions[p.id].state === 'running' ? (Date.now()-sessions[p.id].startTime) : 0;
                m += Math.floor((sessions[p.id].accumulated + el)/60000);
            }
            total += m;
            // Check targets based on period progress for non-daily tasks
            const prog = p.period === 'day' ? m : (periodProgress[p.id] || 0) + (p.period !== 'day' && sessions[p.id] ? Math.floor((sessions[p.id].accumulated + (sessions[p.id].state==='running'?(Date.now()-sessions[p.id].startTime):0))/60000) : 0);
            if(prog >= p.target) doneCount++;
        });
        document.getElementById('sum-time').innerText = formatTime(total);
        document.getElementById('sum-tasks').innerText = `${doneCount}/${projects.length}`;
        const eff = workGoal > 0 ? Math.round((total/workGoal)*100) : 0;
        document.getElementById('sum-eff').innerText = `${eff}%`;
    }

    function updateRings() {
        const h = new Date().getHours() + new Date().getMinutes()/60;
        const dayPct = Math.max(0, Math.min(1, (h - WAKE_TIME)/(SLEEP_TIME - WAKE_TIME)));
        setRing('ring-day', dayPct, '#666');
        
        const d = getTodayData();
        let total = 0;
        projects.filter(p => p.prio <= 3).forEach(p => {
            let m = d[p.id] || 0;
            if(sessions[p.id]) {
                const el = sessions[p.id].state === 'running' ? (Date.now()-sessions[p.id].startTime) : 0;
                m += Math.floor((sessions[p.id].accumulated + el)/60000);
            }
            total += m;
        });
        const budgetPct = workGoal > 0 ? total/workGoal : 0;
        setRing('ring-budget', budgetPct, budgetPct >= 1 ? 'var(--gold)' : '#ff8800');
    }

    function setRing(id, pct, color) {
        const c = document.getElementById(id);
        const offset = (c.r.baseVal.value * 2 * Math.PI) * (1 - pct);
        c.style.strokeDashoffset = offset;
        c.style.stroke = color;
    }

    function formatTime(m) { return m >= 60 ? (m/60).toFixed(1) + 'h' : m + 'm'; }
    function formatTimeShort(m) { return m >= 60 ? Math.round(m/60) + 'h' : m + 'm'; }
    
    function setFilter(mode, btn) {
        filterMode = mode;
        document.querySelectorAll('.filter-pill').forEach(el=>el.classList.remove('active'));
        btn.classList.add('active');
        render();
    }
    
    function switchView(v, btn) {
        document.querySelectorAll('.view-section').forEach(el=>el.classList.remove('active'));
        document.getElementById(`view-${v}`).classList.add('active');
        document.querySelectorAll('.nav-btn').forEach(el=>el.classList.remove('active'));
        btn.classList.add('active');
        if(v==='stats') renderStats();
    }

    function renderStats() {
        const cont = document.getElementById('week-chart'); cont.innerHTML = '';
        const days = ['S√∂n','M√•n','Tis','Ons','Tor','Fre','L√∂r'];
        let max = 1, weekData = [], dist = {1:0, 2:0, 3:0, 4:0};
        for(let i=6; i>=0; i--) {
            const d = new Date(); d.setDate(d.getDate() - i);
            const ds = d.toISOString().split('T')[0];
            const data = history[ds] || {};
            let daySum = 0;
            Object.keys(data).forEach(pid => {
                const m = data[pid]; daySum += m;
                const p = projects.find(x=>x.id===pid);
                if(p) dist[p.prio > 3 ? 4 : p.prio] += m;
            });
            if(daySum > max) max = daySum;
            weekData.push({ day: days[d.getDay()], val: daySum });
        }
        weekData.forEach(d => {
            const h = (d.val/max)*100;
            cont.innerHTML += `<div class="chart-col"><div class="chart-bar" style="height:${h}%; background:${d.val>480?'#4caf50':'#444'}"></div><span class="chart-day">${d.day}</span></div>`;
        });
        const dCont = document.getElementById('prio-breakdown'); dCont.innerHTML = '';
        const totalW = Object.values(dist).reduce((a,b)=>a+b,0);
        const conf = [{id:1,l:'Tung',g:'var(--p1-grad)'},{id:2,l:'Balans',g:'var(--p2-grad)'},{id:3,l:'Grund',g:'var(--p3-grad)'},{id:4,l:'√ñvrigt',g:'var(--p46-grad)'}];
        conf.forEach(c => {
            const val = dist[c.id], pct = totalW>0 ? Math.round((val/totalW)*100) : 0;
            dCont.innerHTML += `<div class="dist-bar"><div class="dist-label">${c.l}</div><div class="dist-track"><div class="dist-fill" style="width:${pct}%; background:${c.g}">${pct>10?formatTime(val):''}</div></div><div style="font-size:0.75rem; width:35px;">${pct}%</div></div>`;
        });
    }

    function confirmReset() {
        if(confirm("‚ö†Ô∏è VARNING: Nollst√§ll allt idag?")) {
            const d = getTodayStr(); if(history[d]) delete history[d];
            sessions = {}; undoStack = []; saveState(); render();
            document.getElementById('modal-settings').style.display='none';
            showToast("Dagen nollst√§lld", false);
        }
    }

    function triggerConfetti() {
        const c = document.getElementById('confetti'); const ctx = c.getContext('2d');
        c.width = window.innerWidth; c.height = window.innerHeight;
        let p = []; for(let i=0; i<100; i++) p.push({x:c.width/2,y:c.height/2,vx:(Math.random()-0.5)*20,vy:(Math.random()-0.5)*20,color:`hsl(${Math.random()*360},100%,50%)`,life:100});
        function step() { ctx.clearRect(0,0,c.width,c.height); p.forEach((k,i)=>{k.x+=k.vx;k.y+=k.vy;k.vy+=0.5;k.life--;ctx.fillStyle=k.color;ctx.fillRect(k.x,k.y,5,5);if(k.life<0)p.splice(i,1)}); if(p.length) requestAnimationFrame(step); }
        step();
    }

    function exportData() {
        const a = document.createElement('a');
        a.href = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify({history, sessions, undoStack, periodProgress, lastDone}));
        a.download = "khalifa_backup.json"; a.click();
    }
    function importData(inp) {
        const r = new FileReader();
        r.onload = e => { const d = JSON.parse(e.target.result); if(d.history) history=d.history; if(d.sessions) sessions=d.sessions; if(d.periodProgress) periodProgress=d.periodProgress; if(d.lastDone) lastDone=d.lastDone; saveState(); alert("Klart!"); render(); };
        r.readAsText(inp.files[0]);
    }
    
    function updateGoal(v) { workGoal=parseInt(v); document.getElementById('goal-display').innerText=formatTime(workGoal); saveState(); render(); }
    function openSettings() { document.getElementById('modal-settings').style.display='flex'; document.getElementById('goal-slider').value=workGoal; document.getElementById('goal-display').innerText=formatTime(workGoal); }
    function showToast(msg, allowUndo) { 
        const t = document.getElementById('toast'); t.querySelector('.toast-msg').innerHTML=msg; 
        document.getElementById('toast-undo-btn').style.display = allowUndo ? 'block' : 'none';
        t.classList.add('show'); setTimeout(()=>t.classList.remove('show'),4000); 
    }

    // INIT
    checkPeriodResets();
    render();
</script>
</body>
</html>
