<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#000000">
    <title>Khalifa Commander</title>
    
    <!-- Ikoner -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root {
            --bg: #050505;
            --card: #121212;
            --active-card: #1a0f0f;
            --text: #ffffff;
            --muted: #666;
            
            --p1: #ff3b30; /* RÃ¶d */
            --p2: #ff9500; /* Orange */
            --p3: #007aff; /* BlÃ¥ */
            --p46: #af52de; /* Lila */
            --gold: #ffd60a; 
            
            --nav-height: 70px;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            padding: 0;
            padding-top: 130px; /* Header space */
            padding-bottom: var(--nav-height); /* Nav space */
            user-select: none;
        }

        /* --- HEADER & RINGS --- */
        .fixed-header {
            position: fixed; top: 0; left: 0; right: 0;
            background: rgba(5,5,5,0.95); backdrop-filter: blur(10px);
            padding: 10px 20px; z-index: 100;
            border-bottom: 1px solid #222;
            display: flex; justify-content: space-between; align-items: center;
            height: 120px;
        }

        .header-info h1 { margin: 0; font-size: 2rem; font-weight: 800; }
        .header-info p { margin: 0; font-size: 0.8rem; color: var(--muted); text-transform: uppercase; }

        .rings-wrapper { display: flex; gap: 15px; }
        .ring-container { position: relative; width: 60px; height: 60px; text-align: center; }
        .ring-svg { transform: rotate(-90deg); width: 60px; height: 60px; }
        .ring-bg { fill: none; stroke: #222; stroke-width: 5; }
        .ring-fill { fill: none; stroke-width: 5; stroke-linecap: round; stroke-dasharray: 150; stroke-dashoffset: 150; transition: stroke-dashoffset 1s ease; }
        .ring-icon { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 1rem; }
        .ring-label { font-size: 0.6rem; color: #666; margin-top: -5px; display: block; }

        /* --- TABS NAVIGATION --- */
        .bottom-nav {
            position: fixed; bottom: 0; left: 0; right: 0;
            height: var(--nav-height);
            background: #111; border-top: 1px solid #222;
            display: flex; justify-content: space-around; align-items: center;
            z-index: 100;
        }
        
        .nav-item {
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            color: #555; font-size: 0.7rem; width: 100%; height: 100%;
            cursor: pointer; transition: color 0.2s;
        }
        .nav-item i { font-size: 1.2rem; margin-bottom: 4px; }
        .nav-item.active { color: var(--gold); background: #1a1a1a; }

        /* --- VIEWS --- */
        .view-section { display: none; padding: 15px; }
        .view-section.active { display: block; animation: fadeIn 0.3s; }

        /* --- TASK CARDS (TODAY) --- */
        .zone-title {
            margin-top: 25px; margin-bottom: 10px; 
            font-size: 0.9rem; font-weight: 700; color: #888; letter-spacing: 1px;
            display: flex; align-items: center; gap: 8px;
        }
        .dot { width: 8px; height: 8px; border-radius: 50%; }

        .task-card {
            background: var(--card); border-radius: 12px; padding: 15px; margin-bottom: 10px;
            border: 1px solid #1f1f1f; display: flex; justify-content: space-between; align-items: center;
            transition: all 0.3s;
        }

        /* ACTIVE STATE (Recording) */
        .task-card.recording {
            background: #2a1010; border-color: var(--p1);
            box-shadow: 0 0 15px rgba(255, 59, 48, 0.2);
            animation: pulse 2s infinite;
        }
        @keyframes pulse { 0% { border-color: var(--p1); } 50% { border-color: #500; } 100% { border-color: var(--p1); } }

        /* DONE STATE (Target Met) */
        .task-card.done { border-color: var(--gold); }
        .task-card.done .task-title { color: var(--gold); }

        .task-left { flex-grow: 1; }
        .task-title { font-size: 1rem; font-weight: 600; display: block; }
        .task-meta { font-size: 0.75rem; color: var(--muted); margin-top: 2px; }
        
        .task-right { display: flex; align-items: center; gap: 15px; }
        .time-badge { font-family: monospace; font-size: 0.9rem; background: #000; padding: 4px 8px; border-radius: 4px; color: #aaa; }
        
        /* PLAY BUTTON */
        .btn-play {
            width: 45px; height: 45px; border-radius: 50%; border: none;
            background: #222; color: #fff; font-size: 1.2rem;
            display: flex; align-items: center; justify-content: center;
            cursor: pointer; box-shadow: 0 4px 10px rgba(0,0,0,0.3);
            transition: transform 0.1s, background 0.2s;
        }
        .btn-play:active { transform: scale(0.9); }
        
        .recording .btn-play { background: var(--p1); color: white; animation: rotateIcon 0s; }
        .recording .time-badge { color: white; }

        /* --- STATS VIEWS (WEEK/MONTH) --- */
        .stat-card { background: var(--card); padding: 15px; border-radius: 12px; margin-bottom: 10px; }
        .stat-row { display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 0.9rem; }
        .stat-bar-bg { height: 8px; background: #222; border-radius: 4px; overflow: hidden; }
        .stat-bar-fill { height: 100%; border-radius: 4px; }
        
        .total-summary { text-align: center; margin-bottom: 20px; }
        .big-number { font-size: 2.5rem; font-weight: 800; color: var(--text); }
        .big-label { font-size: 0.8rem; color: var(--muted); text-transform: uppercase; }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

    </style>
</head>
<body>

    <!-- HEADER -->
    <div class="fixed-header">
        <div class="header-info">
            <h1 id="clock">07:00</h1>
            <p>COMMANDER V6</p>
        </div>
        <div class="rings-wrapper">
            <!-- Ring 1: Dagen -->
            <div class="ring-container">
                <svg class="ring-svg" viewBox="0 0 60 60">
                    <circle class="ring-bg" cx="30" cy="30" r="24"></circle>
                    <circle id="ring-day" class="ring-fill" cx="30" cy="30" r="24" stroke="#666"></circle>
                </svg>
                <div class="ring-icon">ðŸŒ…</div>
                <div class="ring-label">17h</div>
            </div>
            <!-- Ring 2: Budget (Prio 1/2) -->
            <div class="ring-container">
                <svg class="ring-svg" viewBox="0 0 60 60">
                    <circle class="ring-bg" cx="30" cy="30" r="24"></circle>
                    <circle id="ring-budget" class="ring-fill" cx="30" cy="30" r="24" stroke="#ff3b30"></circle>
                </svg>
                <div class="ring-icon">ðŸŽ¯</div>
                <div class="ring-label">Prio</div>
            </div>
        </div>
    </div>

    <!-- VIEW: IDAG -->
    <div id="view-today" class="view-section active">
        <div id="project-list"></div>
        <div style="height: 50px;"></div> <!-- Spacing -->
    </div>

    <!-- VIEW: VECKA -->
    <div id="view-week" class="view-section">
        <div class="total-summary">
            <div class="big-label">Senaste 7 Dagar</div>
            <div class="big-number" id="week-total">0h</div>
        </div>
        <div id="week-breakdown"></div>
    </div>

    <!-- VIEW: MÃ…NAD -->
    <div id="view-month" class="view-section">
        <div class="total-summary">
            <div class="big-label">Senaste 30 Dagar</div>
            <div class="big-number" id="month-total">0h</div>
        </div>
        <div id="month-breakdown"></div>
    </div>

    <!-- NAVIGATION -->
    <div class="bottom-nav">
        <div class="nav-item active" onclick="switchView('today', this)">
            <i class="fas fa-calendar-day"></i>
            <span>IDAG</span>
        </div>
        <div class="nav-item" onclick="switchView('week', this)">
            <i class="fas fa-chart-bar"></i>
            <span>VECKA</span>
        </div>
        <div class="nav-item" onclick="switchView('month', this)">
            <i class="fas fa-calendar-alt"></i>
            <span>MÃ…NAD</span>
        </div>
    </div>

<script>
    // --- KONFIG ---
    const WAKE_TIME = 7; 
    const SLEEP_TIME = 24; 

    // --- PROJEKT LISTA (ALLT SYNLIGT) ---
    const projects = [
        { id: 'yt_long', title: 'YouTube LÃ¥ng', prio: 1, target: 120 },
        { id: 'yt_short', title: 'YouTube Kort', prio: 1, target: 60 },
        
        { id: 'social', title: 'Social Media', prio: 2, target: 45 },
        { id: 'fam_act', title: 'Familj & Lek', prio: 2, target: 60 },
        { id: 'azzah', title: 'Azzah Tid', prio: 2, target: 60 },
        { id: 'kids', title: 'Barn 1-mot-1', prio: 2, target: 30 },
        { id: 'health', title: 'HÃ¤lsa', prio: 2, target: 45 },

        { id: 'prayer', title: 'BÃ¶n & Adhkar', prio: 3, target: 30 },
        { id: 'meals', title: 'Mat & Hus', prio: 3, target: 45 },
        { id: 'learning', title: 'LÃ¤rande', prio: 3, target: 30 },

        { id: 'thriller', title: 'Bok: Deckare', prio: 4, target: 30 },
        { id: 'biz', title: 'Business/Merch', prio: 4, target: 30 },
        { id: 'prep', title: 'Meal Prep', prio: 4, target: 60 },
        
        { id: 'coach', title: 'Coaching', prio: 5, target: 30 },
        
        { id: 'strategy', title: 'Strategi', prio: 6, target: 30 },
        { id: 'ai', title: 'AI & Tech', prio: 6, target: 30 }
    ];

    // --- DATA STORE ---
    // history = { "YYYY-MM-DD": { "yt_long": 60, "social": 15 } }
    let history = JSON.parse(localStorage.getItem('khalifa_history')) || {};
    
    // activeTask = { id: 'yt_long', start: 17023123123 } eller null
    let activeTask = JSON.parse(localStorage.getItem('khalifa_active')) || null;

    // --- DAGENS DATA ---
    function getTodayStr() { return new Date().toISOString().split('T')[0]; }
    function getTodayData() { 
        const d = getTodayStr();
        if(!history[d]) history[d] = {};
        return history[d];
    }
    function save() {
        localStorage.setItem('khalifa_history', JSON.stringify(history));
        localStorage.setItem('khalifa_active', JSON.stringify(activeTask));
    }

    // --- RENDER TODAY ---
    function renderToday() {
        const todayData = getTodayData();
        const list = document.getElementById('project-list');
        list.innerHTML = '';

        const zones = {
            1: { color: 'var(--p1)', title: 'PRIO 1: TUNG', html: '' },
            2: { color: 'var(--p2)', title: 'PRIO 2: BALANS', html: '' },
            3: { color: 'var(--p3)', title: 'PRIO 3: GRUND', html: '' },
            4: { color: 'var(--p46)', title: 'PRIO 4-6: UTVECKLING', html: '' }
        };

        projects.forEach(p => {
            const mins = todayData[p.id] || 0;
            const isTargetMet = mins >= p.target;
            const isActive = activeTask && activeTask.id === p.id;
            
            // Hantera "Gjord" checkmark
            let checkIcon = isTargetMet ? '<i class="fas fa-check-circle" style="color:var(--gold)"></i>' : '';
            
            // Knapp Ikon
            let btnIcon = isActive ? '<i class="fas fa-stop"></i>' : '<i class="fas fa-play"></i>';
            let cardClass = isActive ? 'task-card recording' : (isTargetMet ? 'task-card done' : 'task-card');

            // Om aktiv, visa rÃ¤knande tid
            let displayTime = formatTime(mins);
            if(isActive) displayTime = "REC..."; 

            const html = `
                <div class="${cardClass}">
                    <div class="task-left">
                        <span class="task-title">${p.title} ${checkIcon}</span>
                        <span class="task-meta">MÃ¥l: ${p.target}m</span>
                    </div>
                    <div class="task-right">
                        <span class="time-badge">${displayTime}</span>
                        <button class="btn-play" onclick="toggleTask('${p.id}')">${btnIcon}</button>
                    </div>
                </div>
            `;

            let z = p.prio > 3 ? 4 : p.prio;
            zones[z].html += html;
        });

        // Rita ut zoner
        for(let z=1; z<=4; z++) {
            list.innerHTML += `
                <div class="zone-title">
                    <div class="dot" style="background:${zones[z].color}"></div>
                    ${zones[z].title}
                </div>
                ${zones[z].html}
            `;
        }

        updateRings();
    }

    // --- TIMER LOGIK (START/STOPP) ---
    function toggleTask(id) {
        vibrate(20);
        const now = Date.now();

        if (activeTask && activeTask.id === id) {
            // STOPPA
            const duration = Math.floor((now - activeTask.start) / 60000); // minuter
            if (duration > 0) {
                const d = getTodayStr();
                if (!history[d]) history[d] = {};
                if (!history[d][id]) history[d][id] = 0;
                history[d][id] += duration;
            }
            activeTask = null;
        } else {
            // OM ANNAN AKTIV -> STOPPA DEN FÃ–RST
            if (activeTask) {
                const prevId = activeTask.id;
                const duration = Math.floor((now - activeTask.start) / 60000);
                if (duration > 0) {
                    const d = getTodayStr();
                    if (!history[d]) history[d] = {};
                    if (!history[d][prevId]) history[d][prevId] = 0;
                    history[d][prevId] += duration;
                }
            }
            // STARTA NY
            activeTask = { id: id, start: now };
        }
        save();
        renderToday();
    }

    // --- RENDER STATS (VECKA/MÃ…NAD) ---
    function renderStats(days, containerId, totalId) {
        const container = document.getElementById(containerId);
        container.innerHTML = '';
        
        let totalMins = 0;
        let categoryMins = { 1:0, 2:0, 3:0, 4:0 }; // Prio buckets
        
        // Loopa bakÃ¥t X dagar
        for(let i=0; i<days; i++) {
            const d = new Date();
            d.setDate(d.getDate() - i);
            const dateStr = d.toISOString().split('T')[0];
            const dayData = history[dateStr] || {};
            
            projects.forEach(p => {
                if(dayData[p.id]) {
                    const m = dayData[p.id];
                    totalMins += m;
                    let z = p.prio > 3 ? 4 : p.prio;
                    categoryMins[z] += m;
                }
            });
        }

        document.getElementById(totalId).innerText = (totalMins/60).toFixed(1) + "h";

        // Rita bars fÃ¶r kategorier
        const cats = [
            { id:1, label:'Prio 1 (Tung)', color:'var(--p1)' },
            { id:2, label:'Prio 2 (Balans)', color:'var(--p2)' },
            { id:3, label:'Prio 3 (Grund)', color:'var(--p3)' },
            { id:4, label:'Prio 4-6 (Framtid)', color:'var(--p46)' }
        ];

        cats.forEach(c => {
            const val = categoryMins[c.id];
            const pct = totalMins > 0 ? (val / totalMins) * 100 : 0;
            const html = `
                <div class="stat-card">
                    <div class="stat-row">
                        <span style="color:${c.color}; font-weight:bold;">${c.label}</span>
                        <span>${formatTime(val)}</span>
                    </div>
                    <div class="stat-bar-bg">
                        <div class="stat-bar-fill" style="width:${pct}%; background:${c.color}"></div>
                    </div>
                </div>
            `;
            container.innerHTML += html;
        });
    }

    // --- RINGS ---
    function updateRings() {
        // Ring 1: Tid (17h)
        const now = new Date();
        const h = now.getHours() + now.getMinutes()/60;
        const dayPct = Math.max(0, Math.min(1, (h - WAKE_TIME)/(SLEEP_TIME - WAKE_TIME)));
        setRing('ring-day', dayPct, '#666');

        // Ring 2: Budget (Bara Prio 1 & 2 rÃ¤knas!)
        const todayData = getTodayData();
        let totalGoal = 0;
        let totalDone = 0;
        
        projects.filter(p => p.prio <= 2).forEach(p => {
            totalGoal += p.target;
            totalDone += Math.min(p.target, (todayData[p.id] || 0)); // Cap at target for percentage
        });
        
        const budgetPct = totalGoal > 0 ? totalDone / totalGoal : 0;
        const color = budgetPct >= 1 ? 'var(--gold)' : 'var(--p1)';
        setRing('ring-budget', budgetPct, color);
    }

    function setRing(id, pct, color) {
        const circle = document.getElementById(id);
        const r = circle.r.baseVal.value;
        const c = r * 2 * Math.PI;
        const offset = c - (pct * c);
        circle.style.strokeDashoffset = offset;
        circle.style.stroke = color;
    }

    // --- UTILS ---
    function switchView(viewName, btn) {
        document.querySelectorAll('.view-section').forEach(el => el.classList.remove('active'));
        document.getElementById('view-' + viewName).classList.add('active');
        
        document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
        btn.classList.add('active');

        if(viewName === 'week') renderStats(7, 'week-breakdown', 'week-total');
        if(viewName === 'month') renderStats(30, 'month-breakdown', 'month-total');
    }

    function formatTime(m) {
        if(m >= 60) return (m/60).toFixed(1) + 'h';
        return m + 'm';
    }
    
    function vibrate(ms) { if(navigator.vibrate) navigator.vibrate(ms); }

    function updateClock() {
        const d = new Date();
        document.getElementById('clock').innerText = d.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
        
        // Auto-update timer display visual only (logiken sker vid stopp)
        if(activeTask) {
            renderToday(); // Refresh UI to show "REC..." pulse
        }
    }

    // INIT
    setInterval(updateClock, 30000); // 30 sek uppdatering
    updateClock();
    renderToday();

</script>
</body>
</html>
