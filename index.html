<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#000000">
    <title>Khalifa Commander v7</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root {
            --bg: #050505;
            --card-bg: #141414;
            --text: #fff;
            
            /* WOW-GRADIENTS */
            --p1-grad: linear-gradient(135deg, #ff3b30, #ff6b30);
            --p2-grad: linear-gradient(135deg, #ff9500, #ffcc00);
            --p3-grad: linear-gradient(135deg, #007aff, #00b4ff);
            --p46-grad: linear-gradient(135deg, #5e5ce6, #bf5af2);
            
            --p1-glow: rgba(255, 59, 48, 0.3);
            --gold: #ffd60a;
            
            --nav-height: 80px;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0; padding: 0;
            padding-top: 180px; /* Plats f칬r Header + Filter */
            padding-bottom: 100px;
            overscroll-behavior-y: none;
        }

        /* --- HEADER & RINGS --- */
        .fixed-header {
            position: fixed; top: 0; left: 0; right: 0;
            background: rgba(0,0,0,0.95); backdrop-filter: blur(20px);
            z-index: 100; border-bottom: 1px solid #222;
        }
        
        .top-deck {
            display: flex; justify-content: space-between; align-items: center;
            padding: 15px 20px; height: 110px;
        }

        .clock-area h1 { margin: 0; font-size: 2.2rem; font-weight: 800; letter-spacing: -1px; }
        .clock-area p { margin: 0; font-size: 0.8rem; color: #666; text-transform: uppercase; font-weight: 700; }

        /* FILTER BAR (Sticky under header) */
        .filter-bar {
            display: flex; gap: 10px; padding: 10px 20px;
            border-top: 1px solid #1a1a1a; overflow-x: auto;
        }
        
        .filter-pill {
            background: #222; border: 1px solid #333; color: #888;
            padding: 8px 16px; border-radius: 20px; font-size: 0.85rem; font-weight: 600;
            white-space: nowrap; cursor: pointer; transition: all 0.2s;
        }
        .filter-pill.active { background: #fff; color: #000; border-color: #fff; }

        /* RINGS */
        .rings { display: flex; gap: 15px; }
        .ring-box { position: relative; width: 55px; height: 55px; }
        .ring-svg { transform: rotate(-90deg); width: 55px; height: 55px; }
        .ring-bg { fill: none; stroke: #222; stroke-width: 5; }
        .ring-val { fill: none; stroke-width: 5; stroke-linecap: round; stroke-dasharray: 140; stroke-dashoffset: 140; transition: stroke-dashoffset 1s; }
        .ring-icon { position: absolute; top:50%; left:50%; transform:translate(-50%,-50%); font-size:1.2rem;}

        /* --- CARDS DESIGN --- */
        .zone-label {
            margin: 30px 20px 10px 20px; font-size: 0.8rem; font-weight: 800; 
            color: #555; text-transform: uppercase; letter-spacing: 1px; display: flex; align-items: center; gap: 10px;
        }
        .zone-line { flex-grow: 1; height: 1px; background: #222; }

        .task-card {
            background: var(--card-bg); margin: 0 20px 15px 20px; padding: 20px;
            border-radius: 18px; border: 1px solid #222;
            display: flex; justify-content: space-between; align-items: center;
            transition: transform 0.2s; position: relative; overflow: hidden;
        }

        /* PRIO 1 SPECIAL STYLE (HERO) */
        .prio-1 {
            background: linear-gradient(145deg, #1a0505 0%, #0a0a0a 100%);
            border: 1px solid #4a1a1a;
            transform: scale(1.02);
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        .prio-1 .task-title { font-size: 1.2rem; font-weight: 800; }
        .prio-1-border { position: absolute; left: 0; top: 0; bottom: 0; width: 6px; background: var(--p1-grad); }

        /* PRIO 4-6 COMPACT STYLE */
        .prio-low { padding: 15px 20px; opacity: 0.9; }
        .prio-low .task-title { font-size: 0.9rem; }
        .prio-low .btn-play { width: 45px; height: 45px; font-size: 1rem; }

        /* STATES */
        .task-card.recording {
            border-color: #ff3b30; background: #220a0a;
            box-shadow: 0 0 20px rgba(255, 59, 48, 0.15);
            animation: breathe 2s infinite;
        }
        @keyframes breathe { 0% { border-color: #ff3b30; } 50% { border-color: #800; } 100% { border-color: #ff3b30; } }

        .task-card.done .task-title { color: var(--gold); }
        .task-card.done { border-color: rgba(255, 214, 10, 0.3); }

        /* TEXT & BUTTONS */
        .task-info { flex-grow: 1; }
        .task-title { font-size: 1rem; font-weight: 700; display: block; margin-bottom: 4px; }
        .task-meta { font-size: 0.8rem; color: #666; }
        
        .task-action { display: flex; align-items: center; gap: 15px; }
        
        /* LIVE TIMER BADGE */
        .timer-badge { 
            font-family: monospace; font-size: 1rem; color: #888; 
            background: #000; padding: 6px 10px; border-radius: 8px; min-width: 60px; text-align: center;
        }
        .recording .timer-badge { color: #ff3b30; font-weight: bold; background: #2a0000; }
        .done .timer-badge { color: var(--gold); }

        /* BIG PLAY BUTTON */
        .btn-play {
            width: 60px; height: 60px; border-radius: 50%; border: none;
            background: #252525; color: #fff; font-size: 1.4rem;
            display: flex; align-items: center; justify-content: center;
            cursor: pointer; transition: transform 0.1s;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        .btn-play:active { transform: scale(0.9); }
        .recording .btn-play { background: var(--p1-grad); animation: spin 4s linear infinite; }
        
        @keyframes spin { 100% { transform: rotate(360deg); } }

        /* --- BOTTOM NAV --- */
        .nav-bar {
            position: fixed; bottom: 0; left: 0; right: 0; height: 80px;
            background: #000; border-top: 1px solid #222;
            display: grid; grid-template-columns: 1fr 1fr 1fr;
            padding-bottom: 10px; z-index: 200;
        }
        .nav-btn {
            background: none; border: none; color: #555;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            font-size: 0.7rem; gap: 5px;
        }
        .nav-btn.active { color: #fff; }
        .nav-btn i { font-size: 1.4rem; }

        /* CONFETTI CANVAS */
        #confetti { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 9999; }

        /* UTILS */
        .hidden { display: none !important; }
        .view-section { display: none; }
        .view-section.active { display: block; animation: fadeUp 0.3s; }
        @keyframes fadeUp { from { opacity:0; transform:translateY(20px); } to { opacity:1; transform:translateY(0); } }

    </style>
</head>
<body>

    <canvas id="confetti"></canvas>

    <!-- HEADER -->
    <div class="fixed-header">
        <div class="top-deck">
            <div class="clock-area">
                <h1 id="clock">07:00</h1>
                <p>WARLORD V7</p>
            </div>
            <div class="rings">
                <!-- Ring 1: Tid (17h) -->
                <div class="ring-box">
                    <svg class="ring-svg" viewBox="0 0 55 55">
                        <circle class="ring-bg" cx="27.5" cy="27.5" r="22"></circle>
                        <circle id="ring-day" class="ring-val" cx="27.5" cy="27.5" r="22" stroke="#444"></circle>
                    </svg>
                    <div class="ring-icon">游깬</div>
                </div>
                <!-- Ring 2: Budget (Prio 1-3) -->
                <div class="ring-box">
                    <svg class="ring-svg" viewBox="0 0 55 55">
                        <circle class="ring-bg" cx="27.5" cy="27.5" r="22"></circle>
                        <circle id="ring-budget" class="ring-val" cx="27.5" cy="27.5" r="22" stroke="url(#gradPrio)"></circle>
                        <defs><linearGradient id="gradPrio" x1="0%" y1="0%" x2="100%" y2="0%"><stop offset="0%" stop-color="#ff3b30" /><stop offset="100%" stop-color="#ffcc00" /></linearGradient></defs>
                    </svg>
                    <div class="ring-icon">游댠</div>
                </div>
            </div>
        </div>

        <!-- FILTER TABS -->
        <div class="filter-bar">
            <div class="filter-pill active" onclick="setFilter('today', this)">IDAG (1-3)</div>
            <div class="filter-pill" onclick="setFilter('all', this)">ALLA</div>
            <div class="filter-pill" onclick="setFilter('todo', this)">G칐RA</div>
        </div>
    </div>

    <!-- MAIN VIEW: TODAY -->
    <div id="view-today" class="view-section active">
        <div id="task-list"></div>
    </div>

    <!-- STATS VIEWS -->
    <div id="view-week" class="view-section" style="padding: 20px;">
        <h2>Veckans Insats</h2>
        <div id="week-stats"></div>
    </div>

    <div id="view-month" class="view-section" style="padding: 20px;">
        <h2>M친nadens Insats</h2>
        <div id="month-stats"></div>
    </div>

    <!-- NAV BAR -->
    <div class="nav-bar">
        <button class="nav-btn active" onclick="switchTab('today', this)"><i class="fas fa-bolt"></i>FOKUS</button>
        <button class="nav-btn" onclick="switchTab('week', this)"><i class="fas fa-chart-column"></i>VECKA</button>
        <button class="nav-btn" onclick="switchTab('month', this)"><i class="fas fa-calendar"></i>M칀NAD</button>
    </div>

<script>
    // --- SETUP ---
    const WAKE_TIME = 7;
    const SLEEP_TIME = 24;

    const projects = [
        { id: 'yt_long', title: 'YouTube L친ng', prio: 1, target: 120 },
        { id: 'yt_short', title: 'YouTube Kort', prio: 1, target: 60 },
        
        { id: 'social', title: 'Social Media', prio: 2, target: 45 },
        { id: 'fam_act', title: 'Familj & Lek', prio: 2, target: 60 },
        { id: 'azzah', title: 'Azzah Tid', prio: 2, target: 60 },
        { id: 'kids', title: 'Barn 1-mot-1', prio: 2, target: 30 },
        { id: 'health', title: 'H칛lsa', prio: 2, target: 45 },

        { id: 'prayer', title: 'B칬n & Adhkar', prio: 3, target: 30 },
        { id: 'meals', title: 'Mat & Hus', prio: 3, target: 45 },
        { id: 'learning', title: 'L칛rande', prio: 3, target: 30 },

        { id: 'thriller', title: 'Bok: Deckare', prio: 4, target: 30 },
        { id: 'biz', title: 'Business/Merch', prio: 4, target: 30 },
        { id: 'prep', title: 'Meal Prep', prio: 4, target: 60 },
        
        { id: 'coach', title: 'Coaching', prio: 5, target: 30 },
        { id: 'strategy', title: 'Strategi', prio: 6, target: 30 },
        { id: 'ai', title: 'AI & Tech', prio: 6, target: 30 }
    ];

    let history = JSON.parse(localStorage.getItem('khalifa_v7_hist')) || {};
    let activeTask = JSON.parse(localStorage.getItem('khalifa_v7_active')) || null;
    let filterMode = 'today'; // 'today', 'all', 'todo'

    // --- CORE LOGIC ---
    function getTodayStr() { return new Date().toISOString().split('T')[0]; }
    function getTodayData() { 
        const d = getTodayStr();
        if(!history[d]) history[d] = {};
        return history[d];
    }

    function renderList() {
        const list = document.getElementById('task-list');
        list.innerHTML = '';
        const todayData = getTodayData();

        // Sortera projekten s친 Prio 1 alltid 칛r 칬verst
        const sorted = [...projects].sort((a,b) => a.prio - b.prio);
        
        let lastPrio = 0;

        sorted.forEach(p => {
            // FILTER LOGIK
            if(filterMode === 'today' && p.prio > 3) return;
            if(filterMode === 'todo' && (todayData[p.id] || 0) >= p.target) return;

            // Header f칬r zon
            if(p.prio !== lastPrio) {
                let label = "FRAMTID (Prio 4-6)";
                if(p.prio === 1) label = "游댠 TUNG ZON (Prio 1)";
                if(p.prio === 2) label = "丘뒲잺 BALANS (Prio 2)";
                if(p.prio === 3) label = "丘勇 GRUND (Prio 3)";
                
                list.innerHTML += `<div class="zone-label">${label} <div class="zone-line"></div></div>`;
                lastPrio = p.prio;
            }

            const mins = todayData[p.id] || 0;
            const isActive = activeTask && activeTask.id === p.id;
            const isDone = mins >= p.target;

            // CSS Klasser
            let classes = 'task-card';
            if(p.prio === 1) classes += ' prio-1';
            if(p.prio > 3) classes += ' prio-low';
            if(isActive) classes += ' recording';
            else if(isDone) classes += ' done';

            // Ikon
            let icon = isActive ? '<i class="fas fa-stop"></i>' : '<i class="fas fa-play"></i>';
            if(isDone && !isActive) icon = '<i class="fas fa-check"></i>';

            // Timer Text (Live eller Statisk)
            let timeTxt = formatTime(mins);
            let badgeId = `badge-${p.id}`;

            // Hero Border f칬r Prio 1
            let borderHtml = p.prio === 1 ? '<div class="prio-1-border"></div>' : '';

            list.innerHTML += `
                <div class="${classes}" id="card-${p.id}">
                    ${borderHtml}
                    <div class="task-info">
                        <span class="task-title">${p.title}</span>
                        <span class="task-meta">M친l: ${p.target}m</span>
                    </div>
                    <div class="task-action">
                        <div class="timer-badge" id="${badgeId}">${timeTxt}</div>
                        <button class="btn-play" onclick="toggleTask('${p.id}')">${icon}</button>
                    </div>
                </div>
            `;
        });
        updateRings();
    }

    // --- TIMER SYSTEM ---
    function toggleTask(id) {
        if(navigator.vibrate) navigator.vibrate(20);
        const now = Date.now();

        if(activeTask && activeTask.id === id) {
            // STOP
            const diff = Math.floor((now - activeTask.start)/60000);
            addToHistory(id, diff);
            
            // Kolla om m친let n친ddes JUST NU
            const p = projects.find(x=>x.id===id);
            const total = getTodayData()[id];
            // Trigga konfetti om vi gick 칬ver m친let nyss (eller 칛r 칬ver)
            if(total >= p.target && (total - diff) < p.target) triggerConfetti();
            else if (total >= p.target) triggerConfetti(); // Gener칬s bel칬ning

            activeTask = null;
        } else {
            // SWITCH
            if(activeTask) {
                const diff = Math.floor((now - activeTask.start)/60000);
                addToHistory(activeTask.id, diff);
            }
            // START
            activeTask = { id: id, start: now };
        }

        saveState();
        renderList();
    }

    function addToHistory(id, mins) {
        if(mins <= 0) return;
        const d = getTodayStr();
        if(!history[d]) history[d] = {};
        if(!history[d][id]) history[d][id] = 0;
        history[d][id] += mins;
    }

    // LIVE TIMER UPDATE (Varje sekund)
    setInterval(() => {
        if(activeTask) {
            const now = Date.now();
            const diffSec = Math.floor((now - activeTask.start)/1000);
            
            const badge = document.getElementById(`badge-${activeTask.id}`);
            if(badge) {
                // Formatera MM:SS
                const m = Math.floor(diffSec / 60);
                const s = diffSec % 60;
                badge.innerText = `${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
            }
        }
    }, 1000);

    // --- GUI HELPERS ---
    function setFilter(mode, btn) {
        filterMode = mode;
        document.querySelectorAll('.filter-pill').forEach(el => el.classList.remove('active'));
        btn.classList.add('active');
        renderList();
    }

    function switchTab(view, btn) {
        document.querySelectorAll('.view-section').forEach(el => el.classList.remove('active'));
        document.getElementById(`view-${view}`).classList.add('active');
        
        document.querySelectorAll('.nav-btn').forEach(el => el.classList.remove('active'));
        btn.classList.add('active');

        if(view !== 'today') renderStats(view === 'week' ? 7 : 30, `view-${view}`);
    }

    function updateRings() {
        // Ring 1: Tid (17h)
        const h = new Date().getHours() + new Date().getMinutes()/60;
        const dayPct = Math.max(0, Math.min(1, (h - WAKE_TIME)/(SLEEP_TIME - WAKE_TIME)));
        setRing('ring-day', dayPct);

        // Ring 2: Budget (Prio 1-3)
        const todayData = getTodayData();
        let goal = 0, done = 0;
        projects.filter(p => p.prio <= 3).forEach(p => {
            goal += p.target;
            done += Math.min(p.target, (todayData[p.id] || 0));
        });
        setRing('ring-budget', goal > 0 ? done/goal : 0);
    }

    function setRing(id, pct) {
        const circle = document.getElementById(id);
        const r = circle.r.baseVal.value;
        const c = r * 2 * Math.PI;
        circle.style.strokeDashoffset = c - (pct * c);
    }

    function renderStats(days, containerId) {
        // Enkel text-baserad statistik f칬r nu
        let html = `<div style="text-align:center; padding:20px; color:#666;">Statistik kommer n칛r du har samlat data!</div>`;
        // H칛r kan vi bygga grafer senare
        document.getElementById(containerId).innerHTML = html;
    }

    function saveState() {
        localStorage.setItem('khalifa_v7_hist', JSON.stringify(history));
        localStorage.setItem('khalifa_v7_active', JSON.stringify(activeTask));
    }

    function formatTime(m) {
        return m >= 60 ? (m/60).toFixed(1) + 'h' : m + 'm';
    }

    function updateClock() {
        document.getElementById('clock').innerText = new Date().toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'});
    }

    // --- KONFETTI ---
    function triggerConfetti() {
        const c = document.getElementById('confetti');
        const ctx = c.getContext('2d');
        c.width = window.innerWidth; c.height = window.innerHeight;
        let p = [];
        for(let i=0; i<150; i++) p.push({
            x: c.width/2, y: c.height/2,
            vx: (Math.random()-0.5)*20, vy: (Math.random()-0.5)*20,
            color: `hsl(${Math.random()*360}, 100%, 50%)`, life: 100
        });
        function anim() {
            ctx.clearRect(0,0,c.width,c.height);
            p.forEach((k,i) => {
                k.x+=k.vx; k.y+=k.vy; k.life--; k.vy+=0.5;
                ctx.fillStyle=k.color; ctx.fillRect(k.x,k.y,5,5);
                if(k.life<=0) p.splice(i,1);
            });
            if(p.length) requestAnimationFrame(anim);
        }
        anim();
    }

    // INIT
    setInterval(updateClock, 10000);
    updateClock();
    renderList();

</script>
</body>
</html>
