<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anas Visual Dashboard v4</title>
    <style>
        :root {
            --bg-color: #0d0d0d;
            --card-bg: #1a1a1a;
            --text-main: #ffffff;
            --text-muted: #888;
            
            /* Samma f√§rgschema f√∂r igenk√§nning */
            --prio1: #ff5252; /* R√∂d */
            --prio2: #ff9800; /* Orange */
            --prio3: #2196f3; /* Bl√• */
            --prio46: #9c27b0; /* Lila/Blandat f√∂r strategi */
            
            --day-bar-bg: #333;
            --day-bar-fill: #e0e0e0;
        }

        body {
            font-family: 'Segoe UI', Roboto, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            margin: 0;
            padding: 10px;
            padding-top: 140px; /* Plats f√∂r den fasta toppen */
            padding-bottom: 50px;
        }

        /* --- DEN FASTA TOPPEN (DASHBOARD) --- */
        .fixed-header {
            position: fixed;
            top: 0; left: 0; right: 0;
            background-color: #000;
            padding: 15px;
            z-index: 1000;
            border-bottom: 2px solid #333;
            box-shadow: 0 5px 20px rgba(0,0,0,0.8);
        }

        .top-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .clock { font-size: 1.8rem; font-weight: 800; letter-spacing: 1px; }
        .timer-btn { 
            background: #222; border: 1px solid var(--prio2); color: var(--prio2);
            padding: 5px 12px; border-radius: 5px; cursor: pointer; font-weight: bold;
        }

        /* M√ÑTARE A: 17 TIMMARS DAGEN */
        .meter-label { font-size: 0.75rem; color: #888; display: flex; justify-content: space-between; margin-bottom: 3px;}
        .meter-track {
            background: #222; height: 12px; border-radius: 6px; overflow: hidden; margin-bottom: 8px; position: relative;
        }
        .meter-fill-time {
            height: 100%; background: linear-gradient(90deg, #4caf50, #ffeb3b, #f44336);
            width: 0%; transition: width 1s linear;
        }
        
        /* M√ÑTARE B: DIN INSATS (WORK) */
        .meter-fill-work {
            height: 100%; background: linear-gradient(90deg, #2196f3, #9c27b0);
            width: 0%; transition: width 0.5s ease;
        }

        /* --- JOKER SEKTIONEN (PRIO 4-6) --- */
        .joker-section {
            background: linear-gradient(135deg, #22102a 0%, #1a1a1a 100%);
            border: 1px solid var(--prio46);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .joker-title { color: var(--prio46); font-size: 0.8rem; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 5px; }
        .joker-card-display { font-size: 1.1rem; font-weight: bold; margin-bottom: 10px; }
        
        .joker-controls { display: flex; gap: 10px; justify-content: center; }
        .btn-outline { background: transparent; border: 1px solid #555; color: #ccc; padding: 8px 12px; border-radius: 5px; font-size: 0.8rem; cursor: pointer; }
        .btn-outline:active { background: #333; }

        /* LISTA F√ñR PRIO 4-6 (Dold som default) */
        .extra-list { display: none; text-align: left; margin-top: 15px; border-top: 1px solid #333; padding-top: 10px; }
        .extra-list.show { display: block; animation: fadeIn 0.3s; }

        /* --- HUVUDLISTOR (PRIO 1-3) --- */
        .zone-header {
            padding: 12px; border-radius: 8px; margin-bottom: 8px;
            display: flex; justify-content: space-between; align-items: center;
            font-weight: bold; font-size: 1.1rem; cursor: pointer;
        }
        
        .z1 { background: #2a1a1a; border-left: 5px solid var(--prio1); color: #ffcccc; }
        .z2 { background: #2a2010; border-left: 5px solid var(--prio2); color: #ffe0b2; }
        .z3 { background: #101a2a; border-left: 5px solid var(--prio3); color: #bbdefb; }

        .project-container { display: block; margin-bottom: 20px; } /* Alltid √∂ppna f√∂r √∂verblick, eller toggla */
        
        .task-row {
            background: var(--card-bg);
            border-bottom: 1px solid #222;
            padding: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .task-info { flex-grow: 1; }
        .task-name { font-size: 0.95rem; display: block; }
        .task-meta { font-size: 0.75rem; color: #666; }
        
        .task-actions { display: flex; gap: 5px; }
        .btn-add {
            background: #333; border: none; color: white;
            width: 40px; height: 30px; border-radius: 4px;
            font-weight: bold; cursor: pointer;
        }
        .btn-add:active { background: #fff; color: #000; }

        /* Timer Modal */
        .modal-overlay { display: none; position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.85); z-index:2000; }
        .modal { position: absolute; top: 50%; left: 50%; transform: translate(-50%,-50%); background: #222; padding: 20px; border-radius: 10px; width: 80%; text-align: center; border: 2px solid var(--prio2); }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .flash { animation: flash 0.5s; }
        @keyframes flash { 0% { background-color: #333; } 50% { background-color: #4caf50; } 100% { background-color: #333; } }

    </style>
</head>
<body>

    <!-- FASTA TOPPEN -->
    <div class="fixed-header">
        <div class="top-row">
            <div class="clock" id="clock">00:00</div>
            <button class="timer-btn" onclick="openTimer()">‚è≥ TIMER</button>
        </div>

        <!-- M√ÑTARE 1: DAGEN (TID) -->
        <div class="meter-label">
            <span>Dagens 17 Timmar</span>
            <span id="day-percent">0%</span>
        </div>
        <div class="meter-track">
            <div class="meter-fill-time" id="day-bar"></div>
        </div>

        <!-- M√ÑTARE 2: INSATS (JOBB) -->
        <div class="meter-label">
            <span>Din Insats (M√•l: 14h)</span>
            <span id="work-percent">0%</span>
        </div>
        <div class="meter-track">
            <div class="meter-fill-work" id="work-bar"></div>
        </div>
    </div>

    <!-- JOKER SEKTIONEN (PRIO 4-6) -->
    <div class="joker-section">
        <div class="joker-title">üü£ DAGENS F√ñRSLAG (Prio 4-6)</div>
        <div class="joker-card-display" id="joker-display">Laddar...</div>
        
        <div class="joker-controls">
            <button class="btn-outline" onclick="rollJoker()">üé≤ Slumpa Ny</button>
            <button class="btn-outline" onclick="toggleExtraList()">üìã VISA ALLA</button>
        </div>

        <!-- DEN G√ñMDA LISTAN -->
        <div class="extra-list" id="extra-list-container">
            <!-- H√§r hamnar alla Prio 4, 5, 6 -->
        </div>
    </div>

    <!-- ZON 1: TUNG -->
    <div class="zone-header z1">üî¥ PRIO 1: TUNG (Max 6h)</div>
    <div class="project-container" id="list-prio1"></div>

    <!-- ZON 2: BALANS -->
    <div class="zone-header z2">üü† PRIO 2: BALANS (Max 4h)</div>
    <div class="project-container" id="list-prio2"></div>

    <!-- ZON 3: GRUND -->
    <div class="zone-header z3">üîµ PRIO 3: GRUND (Max 4h)</div>
    <div class="project-container" id="list-prio3"></div>


    <!-- TIMER MODAL -->
    <div class="modal-overlay" id="timer-overlay">
        <div class="modal">
            <h2>Fokus Timer</h2>
            <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-bottom:10px;">
                <button class="btn-outline" onclick="startTimer(15)">15 min</button>
                <button class="btn-outline" onclick="startTimer(30)">30 min</button>
                <button class="btn-outline" onclick="startTimer(45)">45 min</button>
                <button class="btn-outline" onclick="startTimer(60)">60 min</button>
            </div>
            <button class="btn-outline" style="width:100%; border-color:#f44336; color:#f44336" onclick="closeTimer()">Avbryt</button>
            <div id="timer-countdown" style="font-size: 2rem; margin-top: 15px; font-weight:bold;"></div>
        </div>
    </div>

<script>
    // --- KONFIGURATION ---
    const WAKE_TIME = 7; // Klockan 07:00 b√∂rjar m√§taren
    const SLEEP_TIME = 24; // Klockan 00:00 slutar m√§taren (24 = midnatt)
    const TOTAL_DAY_HOURS = SLEEP_TIME - WAKE_TIME; // 17 timmar
    const TOTAL_WORK_GOAL_MINUTES = 14 * 60; // 14 timmar m√•l

    // --- PROJEKT DATA ---
    const projects = [
        // PRIO 1
        { id: 'yt_long', title: 'YouTube L√•ng', meta: 'Batch-inspelning / Planering', prio: 1 },
        { id: 'yt_short', title: 'YouTube Kort', meta: 'Shorts / Reels / Klipp', prio: 1 },
        
        // PRIO 2
        { id: 'social', title: 'Social Media', meta: 'Community & Text', prio: 2 },
        { id: 'fam_act', title: 'Familjeaktivitet', meta: 'Lek / Utflykt', prio: 2 },
        { id: 'azzah', title: 'Azzah Tid', meta: 'Relation & St√∂d', prio: 2 },
        { id: 'kids', title: 'Barn 1-mot-1', meta: 'Fokus tid', prio: 2 },
        { id: 'health', title: 'H√§lsa', meta: 'Promenad / Vila', prio: 2 },

        // PRIO 3
        { id: 'prayer', title: 'B√∂n & Adhkar', meta: 'Andlighet', prio: 3 },
        { id: 'meals', title: 'Mat & Hus', meta: 'Gemenskap & Drift', prio: 3 },
        { id: 'autobio', title: 'Bok: Sj√§lvbiografi', meta: 'Skriv lite', prio: 3 },
        { id: 'learning', title: 'L√§rande', meta: 'Lyssna / L√§sa', prio: 3 },

        // PRIO 4-6 (Dessa hamnar i "Joker" eller "Visa alla")
        { id: 'thriller', title: 'Bok: Deckare', meta: 'Prio 4 (Vecka)', prio: 4 },
        { id: 'biz', title: 'Business/Merch', meta: 'Prio 4 (Vecka)', prio: 4 },
        { id: 'prep', title: 'Meal Prep', meta: 'Prio 4 (Vecka)', prio: 4 },
        { id: 'coach', title: 'Coaching Plattform', meta: 'Prio 5 (Varannan)', prio: 5 },
        { id: 'azzah_biz', title: 'Azzah Business', meta: 'Prio 5 (Varannan)', prio: 5 },
        { id: 'strategy', title: 'Strategi & Framtid', meta: 'Prio 6 (M√•nad)', prio: 6 },
        { id: 'ai', title: 'AI & Tech', meta: 'Prio 6 (M√•nad)', prio: 6 }
    ];

    // --- STATE ---
    let progress = JSON.parse(localStorage.getItem('anasProgressV4')) || {};
    let totalMinutesToday = 0;

    // R√§kna total tid vid start
    for(let key in progress) {
        // Enkel reset-logik: Vi nollst√§ller manuellt "work meter" varje dag i koden nedan
        // F√∂r enkelhetens skull i denna visuella version sparar vi dagens total
    }
    
    // Check Reset (Enkel daglig reset av m√§tare)
    const lastDate = localStorage.getItem('anasDate');
    const todayStr = new Date().toDateString();
    if(lastDate !== todayStr) {
        progress = {}; // Nollst√§ll allt ny dag
        localStorage.setItem('anasDate', todayStr);
        localStorage.setItem('anasProgressV4', JSON.stringify(progress));
    }

    // --- RENDER FUNCTION ---
    function render() {
        // Uppdatera totalen
        totalMinutesToday = Object.values(progress).reduce((a, b) => a + b, 0);
        
        // 1. Render Prio 1-3 Lists
        renderZone(1, 'list-prio1');
        renderZone(2, 'list-prio2');
        renderZone(3, 'list-prio3');

        // 2. Render Extra List (Prio 4-6)
        const extraContainer = document.getElementById('extra-list-container');
        extraContainer.innerHTML = '';
        projects.filter(p => p.prio >= 4).forEach(p => {
            extraContainer.innerHTML += createRow(p);
        });

        // 3. Update Meters
        updateMeters();
    }

    function renderZone(prio, elementId) {
        const container = document.getElementById(elementId);
        container.innerHTML = '';
        projects.filter(p => p.prio === prio).forEach(p => {
            container.innerHTML += createRow(p);
        });
    }

    function createRow(p) {
        const mins = progress[p.id] || 0;
        const timeStr = mins > 0 ? `<span style="color:var(--prio2); font-weight:bold;">${formatTime(mins)}</span>` : '';
        
        return `
            <div class="task-row">
                <div class="task-info">
                    <span class="task-name">${p.title} ${timeStr}</span>
                    <span class="task-meta">${p.meta}</span>
                </div>
                <div class="task-actions">
                    <button class="btn-add" onclick="addTime('${p.id}', 15)">15</button>
                    <button class="btn-add" onclick="addTime('${p.id}', 30)">30</button>
                </div>
            </div>
        `;
    }

    function addTime(id, amount) {
        if(!progress[id]) progress[id] = 0;
        progress[id] += amount;
        localStorage.setItem('anasProgressV4', JSON.stringify(progress));
        render();
    }

    // --- M√ÑTARE LOGIK ---
    function updateMeters() {
        // 1. Time Meter (Day Progress)
        const now = new Date();
        const currentHour = now.getHours() + (now.getMinutes()/60);
        let dayPct = 0;
        
        if(currentHour >= WAKE_TIME && currentHour < SLEEP_TIME) {
            dayPct = ((currentHour - WAKE_TIME) / TOTAL_DAY_HOURS) * 100;
        } else if (currentHour >= SLEEP_TIME) {
            dayPct = 100;
        }
        
        document.getElementById('day-bar').style.width = `${Math.min(dayPct, 100)}%`;
        document.getElementById('day-percent').innerText = `${Math.round(dayPct)}%`;

        // F√§rga stapeln r√∂d om dagen b√∂rjar ta slut
        const bar = document.getElementById('day-bar');
        if(dayPct > 80) bar.style.background = '#f44336'; // R√∂d
        else if(dayPct > 50) bar.style.background = '#ffeb3b'; // Gul

        // 2. Work Meter
        const workPct = (totalMinutesToday / TOTAL_WORK_GOAL_MINUTES) * 100;
        document.getElementById('work-bar').style.width = `${Math.min(workPct, 100)}%`;
        document.getElementById('work-percent').innerText = `${formatTime(totalMinutesToday)}`;
    }

    // --- JOKER LOGIK ---
    function rollJoker() {
        const extras = projects.filter(p => p.prio >= 4);
        const random = extras[Math.floor(Math.random() * extras.length)];
        document.getElementById('joker-display').innerText = random.title;
    }

    function toggleExtraList() {
        const list = document.getElementById('extra-list-container');
        if(list.style.display === 'block') {
            list.style.display = 'none';
        } else {
            list.style.display = 'block';
            list.classList.add('show');
        }
    }

    // --- UTILITIES ---
    function formatTime(m) {
        if(m >= 60) return (m/60).toFixed(1) + 'h';
        return m + 'm';
    }

    function updateClock() {
        const now = new Date();
        document.getElementById('clock').innerText = 
            String(now.getHours()).padStart(2,'0') + ':' + String(now.getMinutes()).padStart(2,'0');
        updateMeters(); // Uppdatera m√§tarna varje minut
    }

    // --- TIMER ---
    let timerInt;
    function openTimer() { document.getElementById('timer-overlay').style.display = 'block'; }
    function closeTimer() { document.getElementById('timer-overlay').style.display = 'none'; clearInterval(timerInt); }
    
    function startTimer(mins) {
        let sec = mins * 60;
        const display = document.getElementById('timer-countdown');
        
        if(timerInt) clearInterval(timerInt);
        
        timerInt = setInterval(() => {
            sec--;
            let m = Math.floor(sec / 60);
            let s = sec % 60;
            display.innerText = `${m}:${String(s).padStart(2,'0')}`;
            
            if(sec <= 0) {
                clearInterval(timerInt);
                display.innerText = "KLART!";
                const audio = new AudioContext(); // Simple beep
                const osc = audio.createOscillator();
                osc.connect(audio.destination);
                osc.start();
                osc.stop(audio.currentTime + 0.5);
                alert("Tiden √§r ute!");
            }
        }, 1000);
    }

    // INIT
    setInterval(updateClock, 60000); // Uppdatera varje minut
    updateClock();
    rollJoker(); // Slumpa en joker vid start
    render();

</script>
</body>
</html>
