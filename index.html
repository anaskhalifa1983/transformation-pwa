<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KHALIFA OS - FINAL</title>
    <style>
        :root {
            --bg-color: #050505;
            --card-bg: #141414;
            --text-main: #e0e0e0;
            --text-muted: #888;
            
            --prio1: #ff4444; 
            --prio2: #ff8800; 
            --prio3: #2196f3; 
            --prio46: #aa00ff;
            
            --gold: #ffd700; /* GULD F√ÑRG */
            --gold-bg: #423a05;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            margin: 0;
            padding: 15px;
            padding-top: 150px; /* Plats f√∂r header */
            padding-bottom: 80px;
            -webkit-user-select: none; /* F√∂rhindra markering text p√• mobil */
            user-select: none;
        }

        /* --- HEADER & M√ÑTARE --- */
        .fixed-header {
            position: fixed;
            top: 0; left: 0; right: 0;
            background: rgba(5,5,5,0.95);
            backdrop-filter: blur(10px);
            padding: 15px;
            z-index: 1000;
            border-bottom: 1px solid #333;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        .top-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
        .clock { font-size: 2rem; font-weight: 900; letter-spacing: -1px; color: #fff; }
        .timer-btn { 
            background: #222; border: 1px solid #444; color: #ccc;
            padding: 6px 14px; border-radius: 20px; font-weight: 600; font-size: 0.9rem;
        }

        .meter-group { margin-bottom: 8px; }
        .meter-label { font-size: 0.7rem; color: #666; display: flex; justify-content: space-between; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 4px; }
        .meter-track { background: #222; height: 8px; border-radius: 4px; overflow: hidden; position: relative; }
        
        /* Dag-m√§tare (Tid) */
        .meter-fill-time { height: 100%; background: linear-gradient(90deg, #4caf50, #ffeb3b, #f44336); width: 0%; transition: width 1s linear; }
        
        /* Jobb-m√§tare (Insats) */
        .meter-fill-work { height: 100%; background: linear-gradient(90deg, #2196f3, #aa00ff); width: 0%; transition: width 0.5s ease; }

        /* --- JOKER / F√ñRSLAG --- */
        .joker-box {
            background: linear-gradient(135deg, #2a0a36 0%, #141414 100%);
            border: 1px solid #4a148c;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 25px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        .joker-label { color: #d1c4e9; font-size: 0.7rem; letter-spacing: 2px; text-transform: uppercase; margin-bottom: 5px; }
        .joker-title { font-size: 1.2rem; font-weight: bold; margin-bottom: 15px; color: #fff; }
        .btn-outline { background: transparent; border: 1px solid #555; color: #aaa; padding: 8px 16px; border-radius: 6px; font-size: 0.8rem; }
        
        /* --- ZONER --- */
        .zone-header {
            padding: 15px; border-radius: 10px; margin-bottom: 10px; margin-top: 20px;
            display: flex; justify-content: space-between; align-items: center;
            font-weight: 800; font-size: 1rem; letter-spacing: 0.5px;
            cursor: pointer; transition: transform 0.1s;
        }
        .zone-header:active { transform: scale(0.98); }
        .arrow { transition: transform 0.3s; opacity: 0.5; }
        .closed .arrow { transform: rotate(-90deg); }

        .z1 { background: linear-gradient(90deg, #2b0b0b, #141414); border-left: 4px solid var(--prio1); color: #ffcccc; }
        .z2 { background: linear-gradient(90deg, #2b1b0b, #141414); border-left: 4px solid var(--prio2); color: #ffe0b2; }
        .z3 { background: linear-gradient(90deg, #0b1b2b, #141414); border-left: 4px solid var(--prio3); color: #bbdefb; }

        .project-list { transition: max-height 0.3s ease; overflow: hidden; }
        .project-list.closed { display: none; }

        /* --- KORTEN --- */
        .task-row {
            background: var(--card-bg);
            border-bottom: 1px solid #222;
            padding: 16px;
            display: flex; justify-content: space-between; align-items: center;
            transition: all 0.3s;
        }
        
        /* GULD STATUS (N√§r klar) */
        .task-row.gold-status {
            background: linear-gradient(90deg, var(--gold-bg), #141414);
            border-left: 3px solid var(--gold);
        }
        .gold-status .task-name { color: var(--gold); text-shadow: 0 0 10px rgba(255, 215, 0, 0.3); }

        .task-info { flex-grow: 1; padding-right: 10px; }
        .task-name { font-size: 1rem; font-weight: 500; display: block; margin-bottom: 4px; }
        .task-meta { font-size: 0.75rem; color: #555; display: block; }
        
        .btn-add {
            background: #252525; border: none; color: #fff;
            width: 44px; height: 34px; border-radius: 6px;
            font-weight: 700; font-size: 0.9rem;
            cursor: pointer; transition: background 0.2s;
        }
        .btn-add:active { background: #fff; color: #000; }

        /* Extra Listan */
        .extra-list { display: none; margin-top: 15px; border-top: 1px solid #333; padding-top: 10px; text-align: left; }
        .extra-list.show { display: block; }

        /* Backup Section */
        .backup-section { text-align: center; margin-top: 50px; padding: 20px; border-top: 1px solid #222; }
        .backup-text { font-size: 0.7rem; color: #444; word-break: break-all; margin-top: 10px; display: none; user-select: text; -webkit-user-select: text;}

        /* Timer Modal */
        .modal-overlay { display: none; position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.9); z-index:2000; backdrop-filter: blur(5px); }
        .modal { position: absolute; top: 40%; left: 50%; transform: translate(-50%,-50%); width: 85%; text-align: center; }
        .timer-big { font-size: 4rem; font-weight: 900; font-variant-numeric: tabular-nums; margin: 20px 0; }
        .grid-btns { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }

    </style>
</head>
<body>

    <!-- TOPP (HUD) -->
    <div class="fixed-header">
        <div class="top-row">
            <div class="clock" id="clock">07:00</div>
            <button class="timer-btn" onclick="openTimer()">‚ö° FOKUS</button>
        </div>

        <!-- M√ÑTARE: DAGEN -->
        <div class="meter-group">
            <div class="meter-label">
                <span>Dagens 17h (07-00)</span>
                <span id="day-percent">0%</span>
            </div>
            <div class="meter-track">
                <div class="meter-fill-time" id="day-bar"></div>
            </div>
        </div>

        <!-- M√ÑTARE: ARBETE -->
        <div class="meter-group">
            <div class="meter-label">
                <span>Energi-Insats</span>
                <span id="work-percent">0h 0m</span>
            </div>
            <div class="meter-track">
                <div class="meter-fill-work" id="work-bar"></div>
            </div>
        </div>
    </div>

    <!-- JOKER -->
    <div class="joker-box">
        <div class="joker-label">‚ú® DAGENS EXTRA-MISSION (Prio 4-6)</div>
        <div class="joker-title" id="joker-display">Laddar...</div>
        <div style="display: flex; gap:10px; justify-content: center;">
            <button class="btn-outline" onclick="rollJoker()">üé≤ Byt</button>
            <button class="btn-outline" onclick="toggleExtra()">üìÇ Alla</button>
        </div>
        <div class="extra-list" id="extra-list"></div>
    </div>

    <!-- ZON 1 -->
    <div class="zone-header z1" onclick="toggleZone('z1-list', this)">
        <span>üî¥ PRIO 1: TUNG (Max 6h)</span>
        <span class="arrow">‚ñº</span>
    </div>
    <div id="z1-list" class="project-list"></div>

    <!-- ZON 2 -->
    <div class="zone-header z2" onclick="toggleZone('z2-list', this)">
        <span>üü† PRIO 2: BALANS (Max 4h)</span>
        <span class="arrow">‚ñº</span>
    </div>
    <div id="z2-list" class="project-list"></div>

    <!-- ZON 3 -->
    <div class="zone-header z3" onclick="toggleZone('z3-list', this)">
        <span>üîµ PRIO 3: GRUND (Max 4h)</span>
        <span class="arrow">‚ñº</span>
    </div>
    <div id="z3-list" class="project-list"></div>


    <!-- BACKUP S√ÑKERHET -->
    <div class="backup-section">
        <button class="btn-outline" onclick="exportData()">üíæ SPARA BACKUP</button>
        <div id="backup-output" class="backup-text"></div>
        <div style="margin-top:10px;">
            <button class="btn-outline" style="border-color:#333; color:#444;" onclick="hardReset()">‚ö† √ÖTERST√ÑLL APP</button>
        </div>
    </div>

    <!-- TIMER MODAL -->
    <div class="modal-overlay" id="timer-overlay">
        <div class="modal">
            <div style="color:#888; letter-spacing: 2px;">FOKUS L√ÑGE</div>
            <div id="timer-display" class="timer-big">00:00</div>
            
            <div id="timer-controls" class="grid-btns">
                <button class="btn-outline" style="border-color:#fff; color:#fff;" onclick="startTimer(15)">15m</button>
                <button class="btn-outline" style="border-color:#fff; color:#fff;" onclick="startTimer(30)">30m</button>
                <button class="btn-outline" style="border-color:#fff; color:#fff;" onclick="startTimer(45)">45m</button>
                <button class="btn-outline" style="border-color:#fff; color:#fff;" onclick="startTimer(60)">60m</button>
            </div>
            <button class="btn-outline" style="width:100%; margin-top:15px; border-color:#f44336; color:#f44336;" onclick="closeTimer()">AVBRYT</button>
        </div>
    </div>

<script>
    // --- INST√ÑLLNINGAR ---
    const WAKE_TIME = 7; 
    const SLEEP_TIME = 24; 

    // --- PROJEKT (NU MED EMOJIS) ---
    const projects = [
        // PRIO 1 (Target: minuter f√∂r att n√• GULD)
        { id: 'yt_long', title: 'üìπ YouTube L√•ng', meta: 'Batch-inspelning / Planering', prio: 1, target: 120 },
        { id: 'yt_short', title: 'üì± YouTube Kort', meta: 'Shorts / Reels / Klipp', prio: 1, target: 60 },
        
        // PRIO 2
        { id: 'social', title: 'üí¨ Social Media', meta: 'Community & Text', prio: 2, target: 45 },
        { id: 'fam_act', title: 'üé≤ Familj & Lek', meta: 'Aktivitet / Utflykt', prio: 2, target: 60 },
        { id: 'azzah', title: '‚ù§Ô∏è Azzah Tid', meta: 'Relation & St√∂d', prio: 2, target: 60 },
        { id: 'kids', title: 'üë∂ Barn 1-mot-1', meta: 'Fokus tid', prio: 2, target: 30 },
        { id: 'health', title: 'üåø H√§lsa', meta: 'Promenad / Vila', prio: 2, target: 45 },

        // PRIO 3
        { id: 'prayer', title: 'üïå B√∂n & Adhkar', meta: 'Andlighet', prio: 3, target: 30 },
        { id: 'meals', title: 'üç≤ Mat & Hus', meta: 'Gemenskap & Drift', prio: 3, target: 45 },
        { id: 'autobio', title: 'üìñ Sj√§lvbiografi', meta: 'Skriv lite', prio: 3, target: 15 },
        { id: 'learning', title: 'üß† L√§rande', meta: 'Lyssna / L√§sa', prio: 3, target: 30 },

        // PRIO 4-6
        { id: 'thriller', title: 'üïµÔ∏è‚Äç‚ôÇÔ∏è Bok: Deckare', meta: 'Veckovis', prio: 4, target: 30 },
        { id: 'biz', title: 'üëï Business/Merch', meta: 'Veckovis', prio: 4, target: 30 },
        { id: 'prep', title: 'ü•¶ Meal Prep', meta: 'Veckovis', prio: 4, target: 60 },
        { id: 'coach', title: 'üéì Coaching', meta: 'Varannan', prio: 5, target: 30 },
        { id: 'strategy', title: '‚ôüÔ∏è Strategi', meta: 'M√•nadsvis', prio: 6, target: 30 },
        { id: 'ai', title: 'ü§ñ AI & Tech', meta: 'M√•nadsvis', prio: 6, target: 30 }
    ];

    // --- LOGIK ---
    let progress = JSON.parse(localStorage.getItem('anasDatav5')) || {};
    
    // Auto-Reset vid ny dag
    const lastDate = localStorage.getItem('anasDatev5');
    const todayStr = new Date().toDateString();
    if(lastDate !== todayStr) {
        progress = {}; 
        localStorage.setItem('anasDatev5', todayStr);
        localStorage.setItem('anasDatav5', JSON.stringify(progress));
    }

    function render() {
        // T√∂m listor
        document.getElementById('z1-list').innerHTML = '';
        document.getElementById('z2-list').innerHTML = '';
        document.getElementById('z3-list').innerHTML = '';
        document.getElementById('extra-list').innerHTML = '';

        let totalMins = 0;

        projects.forEach(p => {
            const mins = progress[p.id] || 0;
            totalMins += mins;
            const isGold = mins >= p.target; // Har vi n√•tt m√•let?
            
            const html = `
                <div class="task-row ${isGold ? 'gold-status' : ''}">
                    <div class="task-info">
                        <span class="task-name">${p.title} ${mins > 0 ? `(${formatTime(mins)})` : ''}</span>
                        <span class="task-meta">${p.meta} ${isGold ? '‚≠ê KLAR' : ''}</span>
                    </div>
                    <div style="display:flex; gap:5px;">
                        <button class="btn-add" onclick="addTime('${p.id}', 15)">15</button>
                        <button class="btn-add" onclick="addTime('${p.id}', 30)">30</button>
                    </div>
                </div>
            `;

            if(p.prio === 1) document.getElementById('z1-list').innerHTML += html;
            else if(p.prio === 2) document.getElementById('z2-list').innerHTML += html;
            else if(p.prio === 3) document.getElementById('z3-list').innerHTML += html;
            else document.getElementById('extra-list').innerHTML += html;
        });

        // Uppdatera m√§tare
        updateMeters(totalMins);
    }

    function addTime(id, amount) {
        if(!progress[id]) progress[id] = 0;
        progress[id] += amount;
        localStorage.setItem('anasDatav5', JSON.stringify(progress));
        render();
    }

    function updateMeters(totalWorkMins) {
        // Tid M√§tare
        const now = new Date();
        const currentHour = now.getHours() + (now.getMinutes()/60);
        const dayDuration = SLEEP_TIME - WAKE_TIME;
        let dayPct = 0;
        
        if(currentHour >= WAKE_TIME) {
            dayPct = ((currentHour - WAKE_TIME) / dayDuration) * 100;
        }
        document.getElementById('day-bar').style.width = Math.min(dayPct, 100) + "%";
        document.getElementById('day-percent').innerText = Math.round(Math.min(dayPct, 100)) + "%";

        // Work M√§tare (M√•l 14h = 840 min)
        const workPct = (totalWorkMins / 840) * 100;
        document.getElementById('work-bar').style.width = Math.min(workPct, 100) + "%";
        document.getElementById('work-percent').innerText = formatTime(totalWorkMins);
    }

    // --- GUI FUNKTIONER ---
    function formatTime(m) {
        if(m >= 60) return (m/60).toFixed(1) + 'h';
        return m + 'm';
    }

    function toggleZone(id, header) {
        const list = document.getElementById(id);
        if(list.classList.contains('closed')) {
            list.classList.remove('closed');
            header.classList.remove('closed');
        } else {
            list.classList.add('closed');
            header.classList.add('closed');
        }
    }

    function rollJoker() {
        const extras = projects.filter(p => p.prio >= 4);
        const random = extras[Math.floor(Math.random() * extras.length)];
        document.getElementById('joker-display').innerText = random.title;
    }

    function toggleExtra() {
        const list = document.getElementById('extra-list');
        list.classList.toggle('show');
    }

    // --- EXPORT / IMPORT ---
    function exportData() {
        const data = JSON.stringify(progress);
        const el = document.getElementById('backup-output');
        el.style.display = 'block';
        el.innerText = data;
        alert("Kopiera texten som d√∂k upp l√§ngst ner och spara i dina Anteckningar!");
    }

    function hardReset() {
        if(confirm("Vill du radera allt?")) {
            localStorage.clear();
            location.reload();
        }
    }

    // --- TIMER ---
    let timerInt;
    function openTimer() { document.getElementById('timer-overlay').style.display = 'block'; }
    function closeTimer() { document.getElementById('timer-overlay').style.display = 'none'; clearInterval(timerInt); }
    
    function startTimer(mins) {
        let sec = mins * 60;
        const display = document.getElementById('timer-display');
        document.getElementById('timer-controls').style.display = 'none'; // G√∂m knappar
        
        if(timerInt) clearInterval(timerInt);
        timerInt = setInterval(() => {
            sec--;
            let m = Math.floor(sec / 60);
            let s = sec % 60;
            display.innerText = `${m}:${String(s).padStart(2,'0')}`;
            
            if(sec <= 0) {
                clearInterval(timerInt);
                display.innerText = "DONE!";
                display.style.color = "var(--gold)";
                // Vibration/Ljud h√§r om m√∂jligt
            }
        }, 1000);
    }

    // START
    setInterval(() => {
        const d = new Date();
        document.getElementById('clock').innerText = d.toTimeString().substr(0, 5);
        updateMeters(Object.values(progress).reduce((a,b)=>a+b,0));
    }, 1000);
    
    rollJoker();
    render();

</script>
</body>
</html>
